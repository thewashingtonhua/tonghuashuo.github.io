{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/2019/10/11/how-to-downgrade-from-homebrew","webpackCompilationHash":"1aa560eaee4f2c5c9b1c","result":{"data":{"site":{"siteMetadata":{"title":"童话说","keywords":["tonghuashuo","github","front-end","javascript","typescript","react","node","washington","hua","童话","童话说","前端","博客","技术","计算机","互联网"]}},"markdownRemark":{"html":"<h1>症状</h1>\n<p>原本只是一次例行的 Homebrew 更新，结果更新完 Yarn 挂了。查了下 Github，果然已经有人提了 <a href=\"https://github.com/yarnpkg/yarn/issues/7584\" target=\"_blank\" rel=\"noopener noreferrer\">Issue</a> 。</p>\n<p>更新导致的问题，回退版本就是了。但坑的是，Homebrew 不像 npm 可以指定任意历史版本，大部分的 formula 仅提供最新版，并且 Homebrew 官方表示<a href=\"https://docs.brew.sh/Versions.html\" target=\"_blank\" rel=\"noopener noreferrer\">这是有意为之</a>。这给回退工作造成了巨大阻碍。</p>\n<h1>后悔药</h1>\n<p>Homebrew 中的每一个 Formula，都对应一个 Ruby 文件，其中记录了关于这个 Formula 的一些信息，包括下载地址。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7199365bd1805cb1cf06bc3cb325d1c5/e662e/yarn-rb.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84.46601941747572%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe7ZQoyCg//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEAAQUCH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8CH//EABoQAAEFAQAAAAAAAAAAAAAAAAABECAhQWH/2gAIAQEAAT8h19L5BD//2gAMAwEAAgADAAAAEDgPPP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EAB0QAQABBAMBAAAAAAAAAAAAAAEAESExURBBYZH/2gAIAQEAAT8QKCFBlnqsB1FvxDQ+pfyb4xn/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"yarn.rb\"\n        title=\"yarn.rb\"\n        src=\"/static/7199365bd1805cb1cf06bc3cb325d1c5/b3ee8/yarn-rb.jpg\"\n        srcset=\"/static/7199365bd1805cb1cf06bc3cb325d1c5/3bc27/yarn-rb.jpg 240w,\n/static/7199365bd1805cb1cf06bc3cb325d1c5/98431/yarn-rb.jpg 480w,\n/static/7199365bd1805cb1cf06bc3cb325d1c5/b3ee8/yarn-rb.jpg 960w,\n/static/7199365bd1805cb1cf06bc3cb325d1c5/b97fe/yarn-rb.jpg 1440w,\n/static/7199365bd1805cb1cf06bc3cb325d1c5/fb329/yarn-rb.jpg 1920w,\n/static/7199365bd1805cb1cf06bc3cb325d1c5/e662e/yarn-rb.jpg 2060w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Homebrew 官方提供的 Formula 是托管在 Github 上的，也就是说是可以看到提交记录的。默认情况下 Homebrew 会从 master 分支读取最新的版本，但 <code class=\"gatsby-code-text\">brew install</code> 命令允许手动指定 Formula 的来源。因此只要我们能够找出某个 Formula 的历史版本，就可以手动安装它。</p>\n<p>通常，我们可以直接在 Github 上点击「History」查看提交记录，但因为 <a href=\"https://github.com/Homebrew/homebrew-core\" target=\"_blank\" rel=\"noopener noreferrer\">Homebrew/homebrew-core</a> 这个仓库的历史提交太多了（每一个 Formula 的更新都算一次提交），系统已经算不过来了，建议大家把仓库克隆到本地之后，借助 SourceTree 等工具进行查看。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9da370ec1ea297348a66dee4be99c38c/d33a2/git-history.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.845261121856865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3aFB/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhAAAwAAAAAAAAAAAAAAAAAAABAx/9oACAEBAAY/AiL/xAAYEAACAwAAAAAAAAAAAAAAAAAAEQEQUf/aAAgBAQABPyFZFEf/2gAMAwEAAgADAAAAEIAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAAMBAQAAAAAAAAAAAAAAAQARIVGh/9oACAEBAAE/EGjaM1d9SnJ//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Git History\"\n        title=\"Git History\"\n        src=\"/static/9da370ec1ea297348a66dee4be99c38c/b3ee8/git-history.jpg\"\n        srcset=\"/static/9da370ec1ea297348a66dee4be99c38c/3bc27/git-history.jpg 240w,\n/static/9da370ec1ea297348a66dee4be99c38c/98431/git-history.jpg 480w,\n/static/9da370ec1ea297348a66dee4be99c38c/b3ee8/git-history.jpg 960w,\n/static/9da370ec1ea297348a66dee4be99c38c/b97fe/git-history.jpg 1440w,\n/static/9da370ec1ea297348a66dee4be99c38c/fb329/git-history.jpg 1920w,\n/static/9da370ec1ea297348a66dee4be99c38c/d33a2/git-history.jpg 2068w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>通过搜索关键字「Yarn」，我们很快就找出了 Yarn 的版本历史。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/93e19b73a94d27fe0ddfd2af1286a6b0/7a1d1/sourcetree.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.36833046471601%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACuklEQVQoz2XQa08aQRQGYD7UqsU2aaq0XhaRixfYXdjbuOzCsoALiNpaAW8IWlbTKFZN9UuT/uymSl3m7UgvNukkT96czMnknPFtkU3/WffosNE5P663L9xGu+vWW780Dk7d7ZMb9/jiq3ty/sVtdi7dRuvM3Wbq7O5Bo9XtMMfb7fO2Xdoc8yl6MV47+IjG0QUanc+oty9RO7xEnam1PmGrdY7aQRe1ZhdbzTO83z8d5M7RJZonN9j9cIV993rQk9Kygm984jWfNjK3uq5Tw7Tvc4Wqpy1bnqJlPFnNeCqxPNNymJKnm0Uva1dYFjxN/9Nj3MuqSSXV/M6F5pO+QCDAl0rlXiFvQS7sUXn9hs4aHfoqdUADSptOakdU3bimUvWKKmtXdPndNU1WLuh4qkkn5BYNyK3+uNwGp+3dzscl0Tc1Nc3ncnaPEIKcs0GN0i6WtDXElFXMxG1w8TzS+ffIVvah5rchmpsQjE2EUxVEpArCUoVGpFUkltfvQlGePTg9w2uE9OLxBN6+XaNGtojpORGhmIRgJIlgNIVEKgOBFCGmy+BZ8mQFUTGDiGAizBt0QcpBs6p3b7iYyFZ+w6fTRk+WJSgkQ5W0A1lfGRAUG4uigUicICOb2FmpYre0jl1nDRtmYWDdyNOqbsOWjLs5NgmbkOMJ0e8kKQUrY/Ytu0yzjGE5VCHZgURSp0GSo+FimYYLJTqXdwYZLgzqfijnYCadv305GxV93GyY19PmD4VNGFuSwMVUBGMKZufV3zSEFglEvYzl4hYUawOisYqkUX1kVjGfyvUC05Gkb3JyKsHzwndB4BFZSHpcVO4HY4+4qNSfWyT9hFrsJ7SVPv+AOCz/8liNJTn/jf2h4BsaeuJnx2LKz56NOSPM6D8Gtf+5MzI65gyP+p3hEb/z9H/lUf8La+jpsP8nxhhB6rtRohkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Git History\"\n        title=\"Git History\"\n        src=\"/static/93e19b73a94d27fe0ddfd2af1286a6b0/f570d/sourcetree.png\"\n        srcset=\"/static/93e19b73a94d27fe0ddfd2af1286a6b0/0783d/sourcetree.png 240w,\n/static/93e19b73a94d27fe0ddfd2af1286a6b0/782f4/sourcetree.png 480w,\n/static/93e19b73a94d27fe0ddfd2af1286a6b0/f570d/sourcetree.png 960w,\n/static/93e19b73a94d27fe0ddfd2af1286a6b0/8d0ff/sourcetree.png 1440w,\n/static/93e19b73a94d27fe0ddfd2af1286a6b0/a987b/sourcetree.png 1920w,\n/static/93e19b73a94d27fe0ddfd2af1286a6b0/7a1d1/sourcetree.png 2324w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>接下来，我们只要让 <code class=\"gatsby-code-text\">brew install</code> 命令可以访问到这个文件就可以了。</p>\n<p><code class=\"gatsby-code-text\">brew install</code> 命令支持从任意网络位置加载 Formula，所以我们只要把这个文件放到某个网络地址，然后把 URL 传给命令就可以了。事实上，Github 作为全球最大的代码托管平台，我们完全可以用它来获取 URL。</p>\n<p>在 Github 中找到 <code class=\"gatsby-code-text\">/Formula/yarn.rb</code> 这个文件，点击「Raw」查看原始文件，注意此时的 URL 中是带有分支名称的，默认是 master，像这样：</p>\n<p><a href=\"https://raw.githubusercontent.com/Homebrew/homebrew-core/master/Formula/yarn.rb\" target=\"_blank\" rel=\"noopener noreferrer\">https://raw.githubusercontent.com/Homebrew/homebrew-core/master/Formula/yarn.rb</a></p>\n<p>把它替换成某个 commit 的 id，就可以查看文件的历史版本了。注意，这里引入问题的版本是 1.19.0，我们需要回到它的上一个版本 1.17.3，因此我们要找的是 1.17.3 这个版本发布时的那个提交：</p>\n<p><a href=\"https://raw.githubusercontent.com/Homebrew/homebrew-core/a7a15e9b10f8652572db9c746a9fd01aa46a5de2/Formula/yarn.rb\" target=\"_blank\" rel=\"noopener noreferrer\">https://raw.githubusercontent.com/Homebrew/homebrew-core/a7a15e9b10f8652572db9c746a9fd01aa46a5de2/Formula/yarn.rb</a></p>\n<p>然后把这一串 URL 作为参数贴到命令行中（为了更好的显示，这里只保留 URL 的头尾，你懂我意思就好）：</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"gatsby-code-bash line-numbers\"><code class=\"gatsby-code-bash\">brew <span class=\"token function\">install</span> https://raw.github<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>5de2/Formula/yarn.rb</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>剩下就只要等屏幕上的日志信息跑完，就大功告成了。（如果因为网络原因报错了，重试看看，或者换个网络再试下）</p>\n<h1>PS</h1>\n<p>截至本文发布，Yarn 官方已经提供了 1.19.1 的 patch 更新，据称已经修复了这个问题。</p>\n<p>经过这一次的踩坑，我也意外的发现，Homebrew 上记录的 Formula 的信息，和这个 Formula 自己的 GitHub 上的版本记录并非完全一致，比如 Yarn 在 1.17.3 和 1.19.0 之间其实还有个 1.18.0 的版本，在 Yarn 自己的 GitHub 的 Release 记录中可以查到，但在 Homebrew 的 Commit History 中就没有看到。</p>\n<p>生命不息，踩坑不止。</p>","frontmatter":{"title":"Homebrew 也有后悔药：回退一次小版本更新","description":"有了后悔药，可劲随便造","cover":{"publicURL":"/static/homebrew-2cd1cc709ca5d68b1a1fb9eb6283b820.jpg"},"tags":["homebrew"],"series":"","draft":false},"fields":{"id":"how-to-downgrade-from-homebrew","date":"2019-10-10T16:00:00.000Z"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/2019/10/11/how-to-downgrade-from-homebrew"}}}