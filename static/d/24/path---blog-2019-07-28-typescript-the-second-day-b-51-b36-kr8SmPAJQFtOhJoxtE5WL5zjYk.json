{"data":{"site":{"siteMetadata":{"title":"童话说","keywords":["tonghuashuo","github","front-end","javascript","typescript","react","node","washington","hua","童话","童话说","前端","博客","技术","计算机","互联网"]}},"markdownRemark":{"html":"<h2>杂谈</h2>\n<p>不知道是就我这样，还是大家也是，最近的内容圈子里关于 TypeScript 的文章满天飞，各种 TypeScript 有多好、多受欢迎，要不就是 TypeScript 的教程、实践。偏偏我在这时候有了写这篇文章的想法，搞得很有跟风蹭热度的嫌疑。</p>\n<p>作为一名坚持原创的作者，我并不想把市面上随手可得的东西，换一种方式再讲给大家听，这样不仅是在浪费大家的时间，也是在浪费我自己的时间。我所理解的为社区做贡献，应该是能够填补当前环境下的一些空白，去做一些真正有意义的事，而不是摆出一副资深的样子，去转发或是创造一些重复的内容。</p>\n<p>今天这篇文章，虽然有跟风的嫌疑，但我向你保证，内容依然是绝对的原创。如有巧合，那么英雄所见略同。</p>\n<h2>为什么是次日？</h2>\n<p>上手 TypeScript 并不难，有 JavaScript 基础的同学，花个一天时间过一遍文档，基本就都清楚了。如果你刚好还有 Java、C# 等后端语言的基础，那么其中关于 OOP 的一些概念相信你一定会觉得非常眼熟。</p>\n<p>如果你刚看完文档就开始准备把 TypeScript 用到项目中去，那么恭喜你，你很快就会遇到各种坑，而且你无法直接从文档中寻找到对应的解决方案。这篇文章的存在，就是希望能够填补这中间的空白，帮助各位顺利的把 TypeScript 落地到项目中。</p>\n<p>这便是标题中「次日」的由来。如果你还没有看过 TypeScript 的文档，那么这篇文章现在还不适合你，建议先收藏起来，等看完了文档再回来。</p>\n<p>如果你已经准备好了，那么我们开始吧。</p>\n<h2>你或许并不需要 TypeScript</h2>\n<p>每个人接触 TypeScript 的原因不同，有的是被人安利，有的是因为团队在用，有的是因为用了 Angular。但不管因为什么入了这个坑，我们都需要明白：TypeScript 并非必须。</p>\n<p>TypeScript 适合大型项目，小型项目最好还是继续用 JavaScript。这已经是业内的一个共识。</p>\n<p>TypeScript 可以简单理解为 JavaScript + Types。从工程效率的角度上讲，Types 的部分属于额外的工作量，如果不能给项目带来足够的收益，去平衡掉其引入的成本，那么这项投入就不是很值得。</p>\n<p>如果只是官网之类的小型项目，类型不类型的并不重要，没必要为了用 TypeScript 而用 TypeScript。但随着项目的规模和复杂度的增加，代码质量、沟通成本等问题开始浮现，而这恰恰是类型系统能够解决的问题。通过类型检测，我们可以更早的发现潜在的类型错误，进行主动防御，进而提高代码质量；通过类型定义，我们可以更加直观的描述我们的数据结构，降低团队作业中的沟通成本。</p>\n<p>因此，要不要用 TypeScript，取决于你项目的类型以及规模，不要盲目跟风。</p>\n<h2>别忘了 jsDoc</h2>\n<p>很多人对 TypeScript 有一个误解，觉得有了静态类型的代码已经足够「自解释」，就不需要 jsDoc 一类的注释了。</p>\n<p>静态类型描述的是数据的结构，而注释描述的是数据的作用，两者解决的是不同的问题，彼此之间并不冲突。</p>\n<p>比如下面这段 JavaScript 代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"gatsby-code-js line-numbers\"><code class=\"gatsby-code-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">convert</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">val<span class=\"token punctuation\">,</span> config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// some code</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>不难看出这是一个转换函数，接收一个待转换的值，以及一个配置对象，但我们并不是这个函数用来转换什么，配置对象又有哪些参数。</p>\n<p>现在我们用 TypeScript 来重写一下，补充一些类型定义。</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"gatsby-code-ts line-numbers\"><code class=\"gatsby-code-ts\"><span class=\"token keyword\">function</span> <span class=\"token function\">convert</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">val<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> x<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">?</span> <span class=\"token punctuation\">:</span><span class=\"token builtin\">boolean</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// some code</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>现在我们知道了这是一个用于处理字符串的转换函数，配置对象有两个参数，一个是必选的字符串，一个是可选的布尔值，最后返回的也是一个字符串。但具体到业务中，这个函数用来转换什么样的字符串，我们还是不太清楚。</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre style=\"counter-reset: linenumber NaN\" class=\"gatsby-code-ts line-numbers\"><code class=\"gatsby-code-ts\"><span class=\"token comment\">/**\n * @description 对手机号进行编码，隐藏其中一部分，如：13812345678 -> 138****5678\n * @param val 待编码的手机号\n * @param config 配置选项\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">convert</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">val<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> x<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">?</span> <span class=\"token punctuation\">:</span><span class=\"token builtin\">boolean</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// some code</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>加上注释之后，一切就都清楚了：这是一个对手机号进行编码，将其中一部分替换成其他字符，以保护用户隐私的函数。</p>\n<p>所以你看，TypeScript 并不能完全替代 jsDoc 的作用，该写的注释还是得写。</p>\n<p>当然对于上面的例子，如果是一个单纯的工具函数，我们完全可以使用更加直观的命名，比如 <code class=\"gatsby-code-text\">encodeMobile (mobile, config)</code>，但如果这是某个类中的成员函数，那么可能就不可避免地会出现示例中的写法。总之，你明白我的意思就好，就不要钻牛角尖了。</p>\n<p>对了，得益于 TypeScript 的类型系统，<code class=\"gatsby-code-text\">@param</code> 不需要再指定数据类型了，只要对变量的用途进行描述就好了。如果你配置了 Lint 工具，它也会提醒你优先使用 TypeScript 来定义类型，不要重复定义。</p>\n<h2>TSX 和 JSX</h2>\n<p>之前我们在用 JavaScript 写 React 时，对文件的扩展名没有什么特别的要求，<code class=\"gatsby-code-text\">*.js</code> 或者 <code class=\"gatsby-code-text\">*.jsx</code> 都行。</p>\n<p>但在 TypeScript 中，如果你要使用 JSX 语法，就不能使用 <code class=\"gatsby-code-text\">*.ts</code>，必须使用 <code class=\"gatsby-code-text\">*.tsx</code>。如果你不知道，或者忘了这么做，那么你会在使用了 JSX 代码的地方收到类型报错，但代码本身怎么看都没有问题。这也是刚上手 TypeScript + React 时几乎每个人都会遇到的坑。</p>\n<p>关于这一点，TypeScript 只是在官方教程的示例代码中直接用了 <code class=\"gatsby-code-text\">*.tsx</code>，但并没有明确说明这一问题。</p>\n<p>React 则在它的官方文档中说明了这一规则：</p>\n<blockquote>\n<p>In React, you most likely write your components in a <code class=\"gatsby-code-text\">.js</code> file. In TypeScript we have 2 file extensions:</p>\n<p><code class=\"gatsby-code-text\">.ts</code> is the default file extension while <code class=\"gatsby-code-text\">.tsx</code> is a special extension used for files which contain JSX.</p>\n</blockquote>\n<blockquote>\n<p>在使用 React 时，我们通常会把组件写在一个 <code class=\"gatsby-code-text\">.*js</code> 文件里。在 TypeScript 中我们有两种文件扩展名：</p>\n<p><code class=\"gatsby-code-text\">.ts</code> 是默认的文件扩展名，而 <code class=\"gatsby-code-text\">.tsx</code> 是用于包含了 JSX 的文件的特殊扩展名。</p>\n</blockquote>\n<p>其实上面这段话也没有明说在 <code class=\"gatsby-code-text\">*.ts</code> 中使用 JSX 会报错，所以即便有人看到了这段话，可能也以为只是像 <code class=\"gatsby-code-text\">*.jsx</code> 一样多了一种选择，并没有太当回事……直到遇到问题。</p>\n<h2>变量的 Type 怎么找</h2>\n<p>上手 TypeScript 之后很快我们就发现，即便是原生的 DOM、或是 React 的 API，也经常会要我们手动指定类型。但这些结构并不是简单的 JavaScript 原始类型，在使用 JavaScript 编写相关代码时候由于没有这种需要，我们也没关心过这些东西的类型，突然问起来，还真不知道这些类型叫什么名字。</p>\n<p>不光是这些标准类型，同样的问题在很多第三方的库中也会遇到，比如一些组件库会检查你传入的 Props。</p>\n<p>在我看来，这中间其实缺少了一部分的文档，来指导新用户如何找到所需要的类型。既然社区没有提供，那就我来吧。</p>\n<p>当然，让每个开发者都熟记所有的类型肯定是不现实的，总不能每接触一个新的库，就要去记一堆类型吧。放心，世界还是美好的，这种事情，当然是有方法的。</p>\n<p>最直白的方法就是去看库的 Types Definition，也就是那些 <code class=\"gatsby-code-text\">.*d.ts</code> 文件。如果你刚好有在用 VS Code 的话，有一个非常方便的操作：把鼠标移动到你想知道它类型的代码上（比如某个变量、某个函数调用，或是某个 JSX 标签、某个组件的 props），右键选择「Go to Definition」（或者光标选中后按 F12），就可以跳转到它的类型定义文件了。</p>\n<p>如果你更习惯使用 VS Code 之外的编辑器，我相信时至今日，它们应该也都早就对 TypeScript 提供了支持。具体操作我不太熟悉，你可以自己探索下（我一直用 VS Code，其它的不太熟）。</p>\n<p>一般来说，这个操作可以直接把你带到你想要的地方，但考虑到类型是可以继承的，有时候一次跳转可能不太够，遇到这种情况，那就需要你随机应变一下，沿着继承关系多跳几次，直到找到你想要的内容。</p>\n<p>对于不熟悉的类型，可以通过这个方法去寻找，慢慢熟悉以后，你会发现，一些常见的类型还是很好找的，稍微联想一下英文的表达方式，配合自动补全的提示，一般都不难找到。</p>\n<p>为了方便初学者，我们还是稍微列举一些常见的类型，找找感觉：</p>\n<h3>常见 Types 之 DOM</h3>\n<p>TypeScript 自带了一些基本的类型定义，包括 ECMAScript 和 DOM 的类型定义，所有你需要的类型都可以从这里找到。如果你想做一些「纯 TypeScript 开发」的话，有这些就够了。</p>\n<p>比如下面这张截图，就是对 <code class=\"gatsby-code-text\">&lt;div&gt;</code> 标签的类型定义。我们可以看到，它继承了更加通用的 <code class=\"gatsby-code-text\">HTMLElement</code> 类型，并且扩展了一个即将被废弃的 <code class=\"gatsby-code-text\">align</code> 属性，以及两组 <code class=\"gatsby-code-text\">addEventListener</code> 和 <code class=\"gatsby-code-text\">removeEventListener</code>，注意这里使用了重载。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/59ea3ce87ce94ba6ab5dbb8d600c0fe2/5c8c8/types-dom.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 68.94409937888199%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACI0lEQVQ4y41TyZabMBDkKzIGxL4Ys28GY3vGmcy85Jr//5lKtcCxL5OXQz21Gqm6VV0Yh25GUs8oj1dk/QL/0CEqR64t7LhAkPfwsga7IMPO3+PFT/HNjb+EkdQjPF4Oqwlx2cHPO+47BAIh4ze/GBAUI8Ji1AVVUkGlT0geq5G1M9x9TTSIqwb74Yy4W5DNNxwIiVVGEiEqetgs6LJjJ13vOLwr8bqS8O3XbyTNxOo8nLVQFTtuZsQnkpEwYAFVHJmfYPKcVTPmZUU5VFL+hcgjMI6vH9SIRFIlKYhSH7bDfL0UlzoncGWV/b2jO9K1O004XN71kx22L5WE3G9PsMoBVr7qZUsHz938A0bLp7nb++0op4YzKikyXGAxLzmBIqyo0Fg7L3TOjh6xwOiW79oWIrQkwukV8e0nQuZdWimkZk5/hd1dEVBDrz3CZO6FMKl10o6wS+rfnWDTdsb09rl1yG5iEnKq6fKOkMNweSmilWz60qoYF7QS9yYnblIOk4OUyTt5q+URmQx7m5Yrg2HssVJw+QF/vMBhh7KPaC2ru0C1Z3Y8wG1G7OgG6VI1LNRQb3pV8ayhhaZ+YmCto+gm5OI1wstq+Gmp9VSMgz0Ht69gyYuYszbc47VDIRSSfIDXn4kJyXjl0z+RLB/saFmtRFjbqr7Ag5C6iNe8ekLQ8++RJ8+c9nSDQ23+1zrrk+k1/Rtt5tQ2ebKC3j+RfQW5+wdE+ppYEGogjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"types dom\"\n        title=\"\"\n        src=\"/static/59ea3ce87ce94ba6ab5dbb8d600c0fe2/f570d/types-dom.png\"\n        srcset=\"/static/59ea3ce87ce94ba6ab5dbb8d600c0fe2/0783d/types-dom.png 240w,\n/static/59ea3ce87ce94ba6ab5dbb8d600c0fe2/782f4/types-dom.png 480w,\n/static/59ea3ce87ce94ba6ab5dbb8d600c0fe2/f570d/types-dom.png 960w,\n/static/59ea3ce87ce94ba6ab5dbb8d600c0fe2/5c8c8/types-dom.png 1127w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n  </span>\n  </a></p>\n<p>这里的命名也不是随便起的，都是在 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLDivElement\" target=\"_blank\" rel=\"noopener noreferrer\">MDN</a> 上可以查到的。</p>\n<p>还是以 <code class=\"gatsby-code-text\">&lt;div&gt;</code> 为例，我们已经知道它继承自 <code class=\"gatsby-code-text\">HTMLElement</code>，其实再往上，<code class=\"gatsby-code-text\">HTMLElement</code> 继承自 <code class=\"gatsby-code-text\">Element</code>，<code class=\"gatsby-code-text\">Element</code> 又继承自 <code class=\"gatsby-code-text\">Node</code>，顺着这条路，你可以挖掘出所有 HTML 标签的类型。</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bfadf4ef868bc1446cd94511666171ee/1f27a/HTMLDivElement.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.6356141797197%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQoz42Q626DMAyFef8nBMFATIyp7doKEpI4CZzZhk6t9mOL9MkX4cOxC+ccpmmCMUbx3itE9BNDCC9o/8gXTzCL5xiwbRuKuq4hlGWJqqrQtq0yDAO6rkPTNOj7XpH+m9TDiPfhQ+fG8wW32eJuFkAEU0rI64qVkRi5ll7KeY9HnpkYI4iJKWsvxoSNZx5vYwpJfCBee8ZsrIqmvPL6lsWy1sZaLIvDyg4C0XGi/VsV4r6gDiWRQaL97w+nkue8O1dX7EacBY6ODTi+GXH+LKg3FNX/Pus8xtMFn+cvnK43dhtfHcrKz+p/IQ7FmSBn+rUyv29cXCDzfE2V4QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"HTMLDivElement\"\n        title=\"\"\n        src=\"/static/bfadf4ef868bc1446cd94511666171ee/f570d/HTMLDivElement.png\"\n        srcset=\"/static/bfadf4ef868bc1446cd94511666171ee/0783d/HTMLDivElement.png 240w,\n/static/bfadf4ef868bc1446cd94511666171ee/782f4/HTMLDivElement.png 480w,\n/static/bfadf4ef868bc1446cd94511666171ee/f570d/HTMLDivElement.png 960w,\n/static/bfadf4ef868bc1446cd94511666171ee/1f27a/HTMLDivElement.png 1213w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n  </span>\n  </a></p>\n<p>对于一些 DOM 相关的属性，比如 <code class=\"gatsby-code-text\">onclick</code>、<code class=\"gatsby-code-text\">onchange</code> 等，你都可以如法炮制，找到它们的定义。</p>\n<h3>常见 Types 之 React</h3>\n<p>关于 TypeScript 的问题，有不少其实是在使用第三方库的时候遇到的，React 就是其中比较常见的一个。</p>\n<h2>标准 lib 也会出错</h2>\n<p>比如 classList</p>\n<h2>FAQ</h2>\n<h3>多重 extends</h3>\n<p>当一个类型 <code class=\"gatsby-code-text\">extends</code> 了多个其它类型，重复属性左边覆盖右边</p>\n<h3>obj[param]无法访问怎么办</h3>\n<p>定义 index</p>\n<h3>OptionBag</h3>\n<p>介绍这种形式</p>","frontmatter":{"title":"TypeScript 次日指南","description":"坑这种东西，是不会写在文档上的","cover":{"publicURL":"/static/typescript-8239307adc5ccdfc32320e1bcadb6300.jpg"},"tags":["typescript"],"series":"","draft":true},"fields":{"id":"typescript-the-second-day","date":"2019-07-27T16:00:00.000Z"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/blog/2019/07/28/typescript-the-second-day"}}