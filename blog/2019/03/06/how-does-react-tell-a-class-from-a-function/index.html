<!DOCTYPE html><html lang="zh"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge,chrome=1"/><meta http-equiv="render" content="webkit"/><meta http-equiv="force-rendering" content="webkit"/><meta http-equiv="format-detection" content="telephone=no"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no, viewport-fit=cover"/><style data-href="/styles.e18ce0ef32839641461c.css">.blog-list .category{position:relative}.blog-list .category .category-header{position:relative;color:#fff;font-size:16px;line-height:1.5;margin-bottom:24px}.blog-list .category .category-posts{position:relative;margin-bottom:24px}.blog-list .category .category-posts .category-post{color:hsla(0,0%,100%,.72);font-size:14px;line-height:1.7;margin-bottom:12px}.blog-list .category .category-posts .category-post a{color:hsla(0,0%,100%,.72)}.blog-list .category .category-posts .category-post a .date{margin-left:12px;font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace}.blog-list .category .category-posts .category-post a .name{margin-left:12px}@media(max-width:768px){.blog-list{padding-top:15px;padding-left:15px;padding-right:15px}}.blog-list .blog{display:flex;flex-direction:row-reverse;transition:background-color .3s ease-out;margin-bottom:20px;border-radius:10px;background-color:#0d0d0d;overflow:hidden}@media(max-width:768px){.blog-list .blog{align-items:stretch;margin-bottom:15px}}.blog-list .blog .banner{overflow:hidden;position:relative;width:240px;height:135px;flex-shrink:0;transition:width .3s ease-out,height .3s ease-out}@media(max-width:1280px){.blog-list .blog .banner{width:240px;height:135px}}@media(max-width:768px){.blog-list .blog .banner{width:200px;min-height:135px;height:auto}}@media(max-width:480px){.blog-list .blog .banner{width:120px;min-height:90px}}.blog-list .blog .banner img{height:100%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.blog-list .blog .info{padding:20px 24px;flex-grow:1;display:flex;flex-direction:column;justify-content:space-between}.blog-list .blog .info .title{color:#fff;font-size:22px;font-weight:700;line-height:30px;margin-bottom:12px;word-wrap:break-word;transition:font-size .3s ease-out,margin-bottom .3s ease-out}@media(max-width:1280px){.blog-list .blog .info .title{margin-bottom:8px}}@media(max-width:768px){.blog-list .blog .info .title{font-size:18px}}@media(max-width:480px){.blog-list .blog .info .title{font-size:14px;margin-bottom:4px}}.blog-list .blog .info .desc{color:hsla(0,0%,100%,.72);word-wrap:break-word;margin-bottom:8px;font-size:14px;line-height:20px;flex-grow:1;transition:color .3s ease-out,font-size .3s ease-out,margin-bottom .3s ease-out}@media(max-width:480px){.blog-list .blog .info .desc{font-size:12px;margin-bottom:4px}}.blog-list .blog .info .blog__footer{display:flex}@media(max-width:768px){.blog-list .blog .info .blog__footer{flex-direction:column}}.blog-list .blog .info .blog__footer .date{font-size:14px;line-height:20px;color:hsla(0,0%,100%,.72);position:relative;white-space:nowrap;transition:font-size .3s ease-out,margin-bottom .3s ease-out}@media(max-width:768px){.blog-list .blog .info .blog__footer .date{margin-bottom:2px;font-size:12px}}.blog-list .blog .info .blog__footer .tags{padding-left:10px;margin-left:10px;display:flex;color:hsla(0,0%,100%,.72);line-height:1;font-size:14px;transition:font-size .3s ease-out;position:relative}@media(max-width:768px){.blog-list .blog .info .blog__footer .tags{font-size:12px}}.blog-list .blog .info .blog__footer .tags:before{content:"";position:absolute;top:50%;left:0;transform:translateY(-50%);width:1px;height:12px;background-color:hsla(0,0%,100%,.72)}@media(max-width:768px){.blog-list .blog .info .blog__footer .tags:before{content:none}}.blog-list .blog.draft .title:before{content:"[ Draft ] ";color:#fc0266}.blog-catelog-toolbar{display:flex;justify-content:flex-end;padding:15px}@media(max-width:768px){.blog-catelog-toolbar{display:none}}.blog-catelog-toolbar .viewmode-selector{display:flex}.blog-catelog-toolbar .viewmode-selector .viewmode-option{font-size:12px;color:hsla(0,0%,100%,.72);transition:color .3s ease-out;cursor:pointer}.blog-catelog-toolbar .viewmode-selector .viewmode-option.active{color:#fff}.blog-catelog-toolbar .viewmode-selector .viewmode-option:not(:first-child){margin-left:1em}#mf-footer{padding:30px}@media(max-width:768px){#mf-footer{padding:30px 15px 50px}}#mf-footer .copyright p{font-size:14px;line-height:20px;color:hsla(0,0%,100%,.72);width:100%;text-align:center}#mf-footer .copyright p svg{width:12px;height:12px;margin-left:4px;margin-right:4px}#mf-footer .sns .links{display:flex;width:150px;justify-content:space-between;align-items:center}#mf-footer .sns .links .link{cursor:pointer;width:20px;height:20px}#mf-footer .sns .links .link svg{display:block;width:100%;height:100%;fill:hsla(0,0%,100%,.72);transition:fill .3s ease-out}#mf-footer .sns .links .link svg:hover{fill:#fff}#mf-header .mf-header-container{position:fixed;top:0;left:0;width:100%;height:48px;background-color:#000;z-index:10;box-shadow:0 2px 4px rgba(0,0,0,.5)}#mf-header .mf-header-container .mf-header-wrapper{width:100%;height:100%;margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:0 30px;transition:max-width .3s ease-out}@media(max-width:1280px){#mf-header .mf-header-container .mf-header-wrapper{max-width:768px;padding:0 15px}}#mf-header .mf-header-container .mf-header-wrapper .brand .brand-link{height:48px;display:flex;align-items:center}#mf-header .mf-header-container .mf-header-wrapper .brand .brand-link .brand-logo{height:32px}#mf-header .mf-header-container .mf-header-wrapper .brand .brand-link .brand-name{display:block;font-size:20px;height:48px;line-height:48px;color:#fff;margin-left:15px;transition:color .3s ease-out,font-size .3s ease-out}@media(max-width:1280px){#mf-header .mf-header-container .mf-header-wrapper .brand .brand-link .brand-name{display:none}}#mf-header .mf-header-container .mf-header-wrapper .brand .brand-link .brand-name:hover{color:#fff}#mf-header .mf-header-placeholder{height:48px}@media(max-width:1280px){.navigation{display:none}}.navigation .nav-menu .menus{display:flex;align-items:center}.navigation .nav-menu .menus .menu:not(:first-child){margin-left:30px}.navigation .nav-menu .menus .menu-link{display:block;height:40px;line-height:40px;font-size:16px;color:hsla(0,0%,100%,.72);text-align:center;transition:color .3s ease-out;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.navigation .nav-menu .menus .menu-link:hover{color:hsla(0,0%,100%,.72)}.navigation .nav-menu .menus .menu-link.active{color:#fff}.navigation-mobile{display:none}@media(max-width:1280px){.navigation-mobile{display:block}}.navigation-mobile .hamberger{width:22px;height:16px;flex-direction:column;justify-content:space-between;border-top:2px solid #fff;border-bottom:2px solid #fff;position:relative;transition:border-color .3s ease-out;cursor:pointer}.navigation-mobile .hamberger:after,.navigation-mobile .hamberger:before{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:50% 50%;width:100%;height:2px;background-color:#fff;transition:transform .3s ease-out}.navigation-mobile .hamberger[data-is-open=true]{border-top-color:transparent;border-bottom-color:transparent}.navigation-mobile .hamberger[data-is-open=true]:before{transform:translate(-50%,-50%) rotate(-45deg)}.navigation-mobile .hamberger[data-is-open=true]:after{transform:translate(-50%,-50%) rotate(45deg)}.navigation-mobile .nav-menu{position:fixed;top:48px;left:0;right:0;bottom:0;background-color:rgba(32,30,30,.88);display:flex;flex-direction:column;justify-content:center;align-items:center;pointer-events:none;z-index:15;opacity:0;transition:opacity .66s cubic-bezier(.66,0,.01,1);-webkit-backdrop-filter:saturate(200%) blur(1.25rem);backdrop-filter:saturate(200%) blur(1.25rem)}.navigation-mobile .nav-menu[data-is-open=true]{opacity:1;pointer-events:all}.navigation-mobile .nav-menu .menus .menu:not(:first-child){margin-top:15px}.navigation-mobile .nav-menu .menus .menu-link{display:block;width:180px;height:40px;line-height:40px;font-size:16px;color:hsla(0,0%,100%,.36);text-align:center;transition:color .3s ease-out;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative}.navigation-mobile .nav-menu .menus .menu-link:hover{color:hsla(0,0%,100%,.72)}.navigation-mobile .nav-menu .menus .menu-link.active{color:#fff;border-radius:8px;font-size:24px;font-weight:700;text-shadow:0 0 20 rgba(28,28,32,.8),0 1px 3px rgba(28,28,32,.2)}.search-bar{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;pointer-events:none;background-color:transparent;transition:background-color .3s ease-out}.search-bar.searching{background-color:#000;pointer-events:all}@media(max-width:480px){.search-bar.searching .wrapper{max-width:100%}}.search-bar .wrapper{width:100%;max-width:350px;pointer-events:all;display:flex;justify-content:center;align-items:center;padding:0 15px}@media(max-width:480px){.search-bar .wrapper{transition:max-width .3s ease-out;max-width:calc(100vw - 130px)}}.search-input{display:flex;align-items:center;width:100%;height:30px;border-radius:15px;background-color:#0d0d0d;padding-right:15px}.search-input .search-input__icon{flex-shrink:0;width:30px;height:30px;display:flex;justify-content:center;align-items:center}.search-input .search-input__icon svg{width:14px;height:14px;fill:#333}.search-input .search-input__input{height:100%;flex-grow:1;background-color:transparent;outline:none;border:none;font-size:14px;color:#fff;min-width:0}.search-input .search-input__input::-webkit-input-placeholder{color:hsla(0,0%,100%,.3)}.search-input .search-input__input:-ms-input-placeholder{color:hsla(0,0%,100%,.3)}.search-input .search-input__input::-ms-input-placeholder{color:hsla(0,0%,100%,.3)}.search-input .search-input__input::placeholder{color:hsla(0,0%,100%,.3)}.search-input .btn-cancel{flex-shrink:0;padding-left:10px;font-size:14px;color:hsla(0,0%,100%,.72);cursor:pointer}.search-result{position:fixed;top:48px;left:0;right:0;bottom:0;background-color:#000;z-index:20;opacity:0;transition:opacity .3s ease-out;pointer-events:none;display:flex;justify-content:center;align-items:flex-start}.search-result.open{opacity:1;pointer-events:all}.search-result .result-container{width:100%;max-width:480px;height:100%;display:flex;justify-content:center;align-items:center;padding:0 0 15px}@media(max-width:1280px){.search-result .result-container{max-width:350px}}.search-result .result-container .result-list{width:100%;height:100%;overflow-y:auto}.search-result .result-container .result-list::-webkit-scrollbar{display:none}.search-result .result-container .result-list .result-category .category-header{padding:15px}.search-result .result-container .result-list .result-category .category-header .category-title{color:hsla(0,0%,100%,.72)}.search-result .result-container .no-result,.search-result .result-container .placeholder{color:hsla(0,0%,100%,.72);width:100%;text-align:center}.result-item{position:relative;background-color:#0d0d0d;border-radius:16px;transition:background-color .3s ease-out}.result-item:not(:first-of-type){margin-top:15px}.result-item.current{background-color:#333}.result-item .result-item-link{display:flex;flex-direction:column;align-items:flex-start;padding:15px;color:hsla(0,0%,100%,.72)}.result-item .result-item-link p{width:100%}.result-item .result-item-link .highlight{color:#fff;background-color:hsla(0,0%,100%,.2);font-weight:700;line-height:inherit;display:inline-flex}.result-item .result-item-link .title{color:hsla(0,0%,100%,.72);font-size:18px;line-height:26px}.result-item .result-item-link .desc{font-size:12px;line-height:20px;margin-top:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
/*! normalize-scss | MIT/GPLv2 License | bit.ly/normalize-scss */html{line-height:1.15}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}main{display:block}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}input{overflow:visible}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;display:table;max-width:100%;padding:0;color:inherit;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}details{display:block}summary{display:list-item}menu{display:block}canvas{display:inline-block}template{display:none}[hidden]{display:none}*{box-sizing:border-box}body,html{margin:0;padding:0}html{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Hiragino Sans GB,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Open Sans,Droid Sans,Microsoft YaHei,WenQuanYi Micro Hei,Helvetica Neue,Tahoma,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;background-color:#000;-webkit-overflow-scrolling:touch;position:relative}h1,h2,h3,h4,h5,h6,p{margin:0;font-weight:400}ol,ul{margin:0;padding:0}ul{list-style:none}a{text-decoration:none}.scroll-lock{overflow:hidden}.mf-content{width:100%;max-width:960px;margin:0 auto;transition:max-width .3s ease-out}@media(max-width:1280px){.mf-content{max-width:768px}}@media(max-width:768px){.mf-content{max-width:100%}}.layout{display:flex;flex-direction:column;min-height:100vh}.layout #mf-footer,.layout #mf-header{flex-shrink:0}.layout #mf-main{flex-grow:1}#page-not-found{height:calc(100vh - 48px);display:flex;flex-direction:column;justify-content:center;align-items:center;padding:15px}#page-not-found h1{color:#fff;font-size:36px}#page-not-found pre{margin-top:40px;margin-bottom:0}#page-not-found pre code{font-size:16px;font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace;color:hsla(0,0%,100%,.72);line-height:1.75}@media(max-width:480px){#page-not-found pre code{font-size:14px}}#page-not-found .btn-back{font-size:16px;font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace;color:#fff;margin-top:50px;display:flex;justify-content:center;align-items:center;padding:15px 30px;border:1px solid #fff;border-radius:4px;transition:background-color .15s ease-out,color .15s ease-out}@media(max-width:480px){#page-not-found .btn-back{font-size:14px}}#page-not-found .btn-back:hover{background-color:#fff;color:#000}#about article{padding:0 15px}#about article h1{color:#fff;font-size:32px;font-weight:700;line-height:1.5;margin-top:50px;margin-bottom:.5em;transition:margin-top .3s ease-out,font-size .3s ease-out}@media(max-width:768px){#about article h1{font-size:28px}}#about article h2{color:#fff;font-size:22px;font-weight:700;line-height:30px;margin-top:50px;margin-bottom:24px;transition:margin-top .3s ease-out,font-size .3s ease-out}@media(max-width:768px){#about article h2{font-size:24px}}#about article p{color:hsla(0,0%,100%,.72);font-size:16px;line-height:20px;margin-top:0;margin-bottom:12px;transition:font-size .3s ease-out}@media(max-width:480px){#about article p{font-size:14px}}#about article p span.highlight{color:#fff}#about article ul{padding-left:20px;margin-bottom:.75em}#about article ul li{list-style:circle;color:hsla(0,0%,100%,.72);font-size:16px;line-height:20px;margin-bottom:12px}@media(max-width:480px){#about article ul li{font-size:14px}}#about article img{width:100%;margin-bottom:1em}#about article img.cover{border-radius:16px}#about article img.qr-wechat{max-width:160px}@media(max-width:480px){#about article img.qr-wechat{max-width:100%}}#about article a{color:#fff}#about article a:hover{text-decoration:underline}.blog-catalog{padding-top:50px}@media(max-width:768px){.blog-catalog{padding-top:0}}.blog-catalog .bottom-line{width:100%;height:30px;position:relative;display:flex;align-items:center;justify-content:space-between}.blog-catalog .bottom-line span{color:hsla(0,0%,100%,.72);padding:0 .5em}.blog-catalog .bottom-line:after,.blog-catalog .bottom-line:before{content:"";height:1px;background-color:hsla(0,0%,100%,.72);flex-grow:1}#friends h1.title{font-weight:100;font-size:32px;color:#fff;padding:0 15px;margin-top:50px;margin-bottom:20px;transition:margin-top .3s ease-out,font-size .3s ease-out}@media(max-width:768px){#friends h1.title{margin-top:20px;font-size:28px}}#friends h2.subtitle{font-weight:100;font-size:24px;color:#fff;padding:0 15px;margin-top:50px;margin-bottom:20px;transition:margin-top .3s ease-out,font-size .3s ease-out}@media(max-width:768px){#friends h2.subtitle{margin-top:20px;font-size:20px}}#friends .friends{display:flex;flex-wrap:wrap}#friends .friend{display:block;flex-shrink:0;width:calc((100% - 20px)/3);padding:10px 15px 30px;transition:background-color .3s ease-out}@media(max-width:768px){#friends .friend{width:calc((100% - 10px)/2)}}@media(max-width:480px){#friends .friend{width:100%}}#friends .friend .cover{width:100%;border-radius:10px;overflow:hidden}#friends .friend .cover img{display:block;width:100%}#friends .friend .intro{padding:10px 0}#friends .friend .intro h2{font-size:18px;color:#fff;line-height:1.5;transition:color .3s ease-out;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media(max-width:480px){#friends .friend .intro h2{font-size:18px}}#friends .friend .intro ul li{color:hsla(0,0%,100%,.72);transition:color .3s ease-out;font-size:14px;line-height:1.5;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media(max-width:480px){#friends .friend .intro ul li{font-size:12px}}.landing{position:relative}.landing-header{display:flex;justify-content:space-between;padding:10px 15px}.landing-header:first-of-type{margin-top:50px}@media(max-width:480px){.landing-header:first-of-type{margin-top:20px}}.landing-header .title{color:#fff;font-size:28px;line-height:32px}.landing-header .more{color:hsla(0,0%,100%,.72);font-size:16px;line-height:32px}.landing-body{margin-bottom:40px}@media(max-width:480px){.landing-body{margin-bottom:20px}}.landing-body .blog{display:block;width:100%;padding:15px;transition:background-color .3s ease-out}@media(max-width:480px){.landing-body .blog{width:100%}}.landing-body .blog .banner{position:relative;border-radius:16px;overflow:hidden}.landing-body .blog .banner img{width:100%}.landing-body .blog .info{padding:10px 0}.landing-body .blog .info .title{color:#fff;font-size:22px;font-weight:700;line-height:1.375;margin-bottom:12px;word-wrap:break-word;transition:font-size .3s ease-out}@media(max-width:480px){.landing-body .blog .info .title{font-size:20px}}.landing-body .blog .info .desc{font-size:14px;line-height:1.3;word-wrap:break-word;margin-bottom:10px;color:hsla(0,0%,100%,.72)}.landing-body .blog .info .blog__footer{display:flex}@media(max-width:768px){.landing-body .blog .info .blog__footer{flex-direction:column}}.landing-body .blog .info .blog__footer .date{font-size:14px;color:hsla(0,0%,100%,.72);line-height:1;position:relative;white-space:nowrap;transition:margin-bottom .3s ease-out}@media(max-width:768px){.landing-body .blog .info .blog__footer .date{margin-bottom:6px}}.project-catalog .title{font-weight:100;font-size:32px;color:#fff;padding:0 15px;margin-top:50px;margin-bottom:20px;transition:margin-top .3s ease-out,font-size .3s ease-out}@media(max-width:768px){.project-catalog .title{margin-top:20px;font-size:28px}}.project-catalog .project-category-title{font-weight:100;font-size:24px;color:#fff;padding:0 15px;margin-top:50px;margin-bottom:20px}.project-catalog .project-list{display:flex;flex-wrap:wrap;margin-bottom:40px}.project-catalog .project-list .project{display:block;flex-shrink:0;width:calc((100% - 20px)/3);padding:15px 15px 30px;transition:background-color .3s ease-out}@media(max-width:768px){.project-catalog .project-list .project{width:calc((100% - 10px)/2)}}@media(max-width:480px){.project-catalog .project-list .project{width:100%}}.project-catalog .project-list .project:nth-child(2n){margin-right:0}.project-catalog .project-list .project .cover{width:100%;border-radius:10px;overflow:hidden}.project-catalog .project-list .project .cover img{display:block;width:100%}.project-catalog .project-list .project .intro{padding:20px 0}.project-catalog .project-list .project .intro h2{font-size:18px;color:#fff;transition:color .3s ease-out;margin-bottom:.5em;position:relative;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media(max-width:480px){.project-catalog .project-list .project .intro h2{font-size:18px}}.project-catalog .project-list .project .intro p{color:hsla(0,0%,100%,.72);transition:color .3s ease-out;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media(max-width:480px){.project-catalog .project-list .project .intro p{font-size:12px}}.project-catalog .project-list .project.draft .intro h2:before{content:"[Draft] ";color:#fc0266}.lab-item article{padding:0 15px}.lab-item a,.lab-item h1,.lab-item h2,.lab-item label,.lab-item li,.lab-item p,.lab-item td,.lab-item th{color:hsla(0,0%,100%,.72);font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace}.lab-item table{width:100%}.lab-item td,.lab-item th{border:1px solid hsla(0,0%,100%,.3);padding:15px;white-space:nowrap}.lab-item tr.title td{color:#fff;padding:25px 15px;font-weight:700}.lab-item h1{font-size:32px;margin-bottom:.5em}.lab-item h1,.lab-item h2{color:#fff;line-height:1.5}.lab-item h2{font-size:28px;margin-top:1em}.lab-item p{color:hsla(0,0%,100%,.72)}.lab-item p,.lab-item ul li{line-height:1.5}.lab-item a{font-size:16px;text-decoration:none}.lab-item a:hover{text-decoration:underline}.lab-item a.back{display:block;font-size:20px;color:hsla(0,0%,100%,.72);padding:50px 0 20px}.lab-item canvas{display:block}.lab-item #error{color:red}#tool-browser-keyboard input{width:100%;height:3em;margin-bottom:30px}#tool-html5-input label{display:block;margin-bottom:.5em;font-size:16px}#tool-html5-input input{width:100%;height:50px;line-height:50px;border:1px solid #999;background-color:transparent;margin-bottom:15px;font-size:16px}#tool-html5-input input[type=\"date\"],#tool-html5-input input[type=\"datetime\"],#tool-html5-input input[type=\"email\"],#tool-html5-input input[type=\"number\"],#tool-html5-input input[type=\"password\"],#tool-html5-input input[type=\"search\"],#tool-html5-input input[type=\"tel\"],#tool-html5-input input[type=\"text\"],#tool-html5-input input[type=\"url\"]{padding-left:1em}#tool-html5-online .online{color:green}#tool-html5-online .offline{color:red}.tool-catalog .category-title{color:#fff;margin-bottom:20px;font-size:32px;font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace;padding:0 15px;transition:margin-top .3s ease-out,font-size .3s ease-out}@media(max-width:768px){.tool-catalog .category-title{font-size:28px}}.tool-catalog .category-title:first-of-type{margin-top:50px}@media(max-width:768px){.tool-catalog .category-title:first-of-type{margin-top:20px}}.tool-catalog .category-items{margin-bottom:20px;width:100%;padding:0 15px;display:flex;flex-wrap:wrap}.tool-catalog .category-items .item{display:block;flex-shrink:0;width:calc((100% - 20px)/3);padding:50px 10px;margin-right:10px;margin-bottom:10px;background-color:#0d0d0d;border-radius:10px;color:hsla(0,0%,100%,.72);text-align:center;font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace;transition:color .3s ease-out,background-color .3s ease-out;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}@media(max-width:768px){.tool-catalog .category-items .item{width:calc((100% - 10px)/2)}}@media(max-width:480px){.tool-catalog .category-items .item{width:100%}}.tool-catalog .category-items .item:hover{color:#fff;background-color:#333}.tool-catalog .category-items .item:nth-child(3n+3){margin-right:0}@media(max-width:480px){.tool-catalog .category-items .item:nth-child(3n+3){margin-right:10px}}@media(max-width:480px){.tool-catalog .category-items .item:nth-child(2n){margin-right:0}}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.gatsby-code-text{font-size:.8em;font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace;color:#fff;background-color:#121212;border-radius:6px;padding:.5em .8em}@media(max-width:1280px){.gatsby-code-text{padding:.2em .5em}}.gatsby-highlight{background:#121212;color:#fff;border-radius:10px;overflow:auto;-moz-tab-size:1.5em;tab-size:1.5em;margin-bottom:15px;-webkit-overflow-scrolling:touch;position:relative}.gatsby-highlight code,.gatsby-highlight span{font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace}.gatsby-highlight code{color:#ccc}.gatsby-highlight>code[class*=gatsby-code-],.gatsby-highlight>pre.prism-code,.gatsby-highlight>pre[class*=gatsby-code-]{height:auto!important;margin:30px 15px 10px 50px;font-size:14px;line-height:20px;white-space:pre;word-break:break-word;overflow-x:auto;overflow-y:hidden;padding-bottom:5px}.gatsby-highlight+.gatsby-highlight{margin-top:20}.gatsby-highlight .token.attr-name{color:#c684c1}.gatsby-highlight .token.block-comment,.gatsby-highlight .token.cdata,.gatsby-highlight .token.comment,.gatsby-highlight .token.doctype,.gatsby-highlight .token.prolog{color:#666}.gatsby-highlight .token.constant,.gatsby-highlight .token.deleted,.gatsby-highlight .token.function-name,.gatsby-highlight .token.number,.gatsby-highlight .token.property,.gatsby-highlight .token.symbol{color:#5a9bcf}.gatsby-highlight .token.boolean{color:#ff8b50}.gatsby-highlight .token.tag{color:#fc929e}.gatsby-highlight .token.string{color:#8dc891}.gatsby-highlight .token.punctuation{color:#88c6be}.gatsby-highlight .token.builtin,.gatsby-highlight .token.char,.gatsby-highlight .token.inserted,.gatsby-highlight .token.selector{color:#d8dee9}.gatsby-highlight .token.function{color:#efbd54}.gatsby-highlight .token.entity,.gatsby-highlight .token.operator,.gatsby-highlight .token.url,.gatsby-highlight .token.variable{color:#9adcff}.gatsby-highlight .token.attr-value{color:#8dc891}.gatsby-highlight .token.keyword{color:#c684c1}.gatsby-highlight .token.atrule,.gatsby-highlight .token.class-name{color:#fac863}.gatsby-highlight .token.important{font-weight:400}.gatsby-highlight .token.bold{font-weight:700}.gatsby-highlight .token.italic{font-style:italic}.gatsby-highlight .token.entity{cursor:help}.gatsby-highlight .namespace{opacity:.7}.gatsby-highlight[data-language]:before{position:absolute;top:0;right:20px;padding:3px 10px;font-size:12px;text-align:right;color:#444;font-weight:700;letter-spacing:.8px;text-transform:uppercase;border-radius:0 0 5px 5px;background:#ddd}.gatsby-highlight[data-language=html]:before{content:"html";background:#ef5f27;color:#fff;font-weight:400}.gatsby-highlight[data-language=css]:before{content:"css";background:#2aa9df;color:#fff;font-weight:400}.gatsby-highlight[data-language=sass]:before{content:"sass";background:#d0649a;color:#fff;font-weight:400}.gatsby-highlight[data-language=scss]:before{content:"scss";background:#d0649a;color:#fff;font-weight:400}.gatsby-highlight[data-language=less]:before{content:"less";background:#1d365d;color:#fff;font-weight:400}.gatsby-highlight[data-language=javascript]:before,.gatsby-highlight[data-language=js]:before{content:"js";background:#f7df1e}.gatsby-highlight[data-language=jsx]:before{content:"jsx";background:#f7df1e}.gatsby-highlight[data-language=ts]:before,.gatsby-highlight[data-language=typescript]:before{content:"ts";background:#284d7f;color:#fff;font-weight:400}.gatsby-highlight[data-language=tsx]:before{content:"tsx";background:#284d7f;color:#fff;font-weight:400}.gatsby-highlight[data-language=bash]:before{content:"bash";background:#f6ffe5;font-weight:400}.gatsby-highlight[data-language=json]:before{content:"json";background:#267cb9;font-weight:400}.gatsby-highlight[data-language=php]:before{content:"php";background:#8892bf;font-weight:400}.gatsby-highlight-code-line{background-color:#28292b;display:block;margin:-.125rem 0;padding:.125rem 0}.line-numbers .line-numbers-rows{top:30px;padding-left:15px}.line-numbers .line-numbers-rows>span{line-height:1.5}.blog-post .back-to-parent{padding:50px 15px 20px}.blog-post .back-to-parent a{color:hsla(0,0%,100%,.72)}.blog-post article{padding:10px 15px 50px;position:relative}@media(max-width:768px){.blog-post article{padding:10px 15px 15px}}.blog-post article a::selection,.blog-post article code::selection,.blog-post article h1::selection,.blog-post article h2::selection,.blog-post article h3::selection,.blog-post article h4::selection,.blog-post article h5::selection,.blog-post article h6::selection,.blog-post article img::selection,.blog-post article li::selection,.blog-post article p::selection,.blog-post article span::selection,.blog-post article td::selection,.blog-post article th::selection,.blog-post article time::selection{background-color:#fff;color:#000}.blog-post article .post-title{color:#fff;font-size:32px;font-weight:700;line-height:40px;margin-bottom:.5em;transition:font-size .3s ease-out;position:relative;text-align:center}@media(max-width:1280px){.blog-post article .post-title{font-size:32px}}@media(max-width:768px){.blog-post article .post-title{font-size:28px}}.blog-post article .metas{display:flex;justify-content:center;margin-bottom:20px}@media(max-width:480px){.blog-post article .metas{flex-direction:column}}.blog-post article .metas .meta{color:hsla(0,0%,100%,.72);font-size:14px;line-height:20px;font-weight:100;position:relative;margin-bottom:0;transition:font-size .3s ease-out,margin-bottom .3s ease-out}@media(max-width:480px){.blog-post article .metas .meta{margin-bottom:4px;font-size:14px}}.blog-post article .metas .meta:not(:first-child){margin-left:30px}@media(max-width:480px){.blog-post article .metas .meta:not(:first-child){margin-left:0}}.blog-post article .metas .meta:not(:first-child):before{content:"";position:absolute;top:50%;left:-15px;transform:translate(-50%,-50%);width:4px;height:4px;background-color:hsla(0,0%,100%,.72);border-radius:50%}@media(max-width:480px){.blog-post article .metas .meta:not(:first-child):before{content:none}}.blog-post article .banner{margin-bottom:20px;border-radius:16px;overflow:hidden}.blog-post article .banner img{width:100%;display:block}.blog-post article .content,.blog-post article .content-wrapper{position:relative}.blog-post article .content h1,.blog-post article .content h2,.blog-post article .content h3,.blog-post article .content h4,.blog-post article .content h5,.blog-post article .content h6{color:#fff;font-weight:700;line-height:1.5;margin-top:1.5em;margin-bottom:.5em;transition:font-size .3s ease-out}.blog-post article .content h1{font-size:32px}@media(max-width:480px){.blog-post article .content h1{font-size:28px}}.blog-post article .content h2{font-size:28px}@media(max-width:480px){.blog-post article .content h2{font-size:24px}}.blog-post article .content h3{font-size:24px}@media(max-width:480px){.blog-post article .content h3{font-size:20px}}.blog-post article .content h4{font-size:20px}@media(max-width:480px){.blog-post article .content h4{font-size:18px}}.blog-post article .content h5{font-size:18px}@media(max-width:480px){.blog-post article .content h5{font-size:16px}}.blog-post article .content h6{font-size:16px}.blog-post article .content p{font-size:15px;color:hsla(0,0%,100%,.72);line-height:1.8;margin-bottom:1em;transition:font-size .3s ease-out}@media(max-width:480px){.blog-post article .content p{font-size:14px}}.blog-post article .content a{color:#fff;word-wrap:break-word;padding:0 .5em 2px;transition:border-bottom-color .3s ease-out}.blog-post article .content a:not(.gatsby-resp-image-link){border-bottom:1px dotted #fff;font-weight:500}.blog-post article .content a:not(.gatsby-resp-image-link)[target=_blank]{display:inline-flex;align-items:center}.blog-post article .content a:not(.gatsby-resp-image-link)[target=_blank]:after{content:"";width:1em;height:1em;margin-left:.3em;background-size:contain;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjZmZmIj48cGF0aCBkPSJNMTkgMTlINVY1aDdWM0g1YTIgMiAwIDAgMC0yIDJ2MTRhMiAyIDAgMCAwIDIgMmgxNGMxLjEgMCAyLS45IDItMnYtN2gtMnY3ek0xNCAzdjJoMy41OWwtOS44MyA5LjgzIDEuNDEgMS40MUwxOSA2LjQxVjEwaDJWM2gtN3oiLz48L3N2Zz4=)}.blog-post article .content .gatsby-resp-image-link:not(:first-child){margin-top:15px}.blog-post article .content ul{list-style:circle}.blog-post article .content ol,.blog-post article .content ul{padding-left:30px;margin-bottom:1em}.blog-post article .content ol ol,.blog-post article .content ol ul,.blog-post article .content ul ol,.blog-post article .content ul ul{margin-bottom:.5em}.blog-post article .content ol li,.blog-post article .content ol p,.blog-post article .content ul li,.blog-post article .content ul p{line-height:1.8;margin-bottom:.5em;color:hsla(0,0%,100%,.72);transition:font-size .3s ease-out}@media(max-width:480px){.blog-post article .content ol li,.blog-post article .content ol p,.blog-post article .content ul li,.blog-post article .content ul p{font-size:14px}}.blog-post article .content table{margin-bottom:15px;min-width:100%;border-collapse:collapse}.blog-post article .content table thead tr{background-color:#1f1f1f}.blog-post article .content table tbody tr:nth-child(odd){background-color:#292929}.blog-post article .content table tbody tr:nth-child(2n){background-color:#1f1f1f}.blog-post article .content table td,.blog-post article .content table th{font-size:15px;line-height:1.75;margin-top:0;margin-bottom:1em;padding:15px 20px;text-align:left;white-space:nowrap;word-wrap:normal;color:hsla(0,0%,100%,.72);transition:font-size .3s ease-out}@media(max-width:480px){.blog-post article .content table td,.blog-post article .content table th{font-size:14px}}.blog-post article .content table td a,.blog-post article .content table th a{padding:0}.blog-post article .content blockquote{margin:0 0 1em;border-left:3px solid hsla(0,0%,100%,.72);background-color:#121212;padding:15px}.blog-post article .content blockquote p{color:hsla(0,0%,100%,.72);font-size:14px;line-height:1.75;margin-bottom:1em}@media(max-width:480px){.blog-post article .content blockquote p{font-size:12px}}.blog-post article .content blockquote p+p{margin-top:.75em}.blog-post article .content blockquote p:last-of-type{margin-bottom:0}.blog-post article .content hr{margin:50px auto;width:80%;height:1px;background-color:hsla(0,0%,100%,.72);border:none}.blog-post article.draft .title:before{content:"[ Draft ] ";color:#fc0266}.blog-post article .toc{position:absolute;top:0;left:calc(100% + 15px);width:240px;max-height:calc(100vh - 70px);overflow-y:auto;border-left:1px dotted hsla(0,0%,100%,.72);padding:10px 15px 10px 0}.blog-post article .toc::-webkit-scrollbar{display:none}@media(max-width:1280px){.blog-post article .toc{display:none}}.blog-post article .toc ul{padding-left:1em}.blog-post article .toc ul li,.blog-post article .toc ul p{margin-bottom:.5em}.blog-post article .toc ul li a{color:hsla(0,0%,100%,.72);font-size:12px;line-height:1.3;transition:color .3s ease-out}.blog-post article .toc ul li a:hover{color:#fff}.blog-post article .series{margin-top:50px;display:flex;flex-direction:column;align-items:flex-start}.blog-post article .series .header{border-top:1px dashed hsla(0,0%,100%,.72);padding-top:50px;margin-bottom:30px;width:100%}.blog-post article .series .header .title{color:hsla(0,0%,100%,.72);font-size:20px}.blog-post article .series .posts{padding-left:30px;list-style:circle}.blog-post article .series .posts .post{font-size:14px;line-height:2}.blog-post article .series .posts .post,.blog-post article .series .posts .post a{color:hsla(0,0%,100%,.72);transition:color .3s ease-out}.blog-post article .series .posts .post a.draft:before{content:"[ Draft ] ";color:#fc0266}.blog-post article .series .posts .post:hover,.blog-post article .series .posts .post:hover a{color:#fff}.project-post .back-to-parent{padding:50px 15px 20px}.project-post .back-to-parent a{color:hsla(0,0%,100%,.72)}.project-post article{padding:10px 15px 50px}.project-post article h1,.project-post article h2,.project-post article h3,.project-post article h4,.project-post article h5{color:#fff;font-weight:700;line-height:1.5;transition:font-size .3s ease-out}.project-post article h1{font-size:32px;margin-top:1em;margin-bottom:.5em}@media(max-width:480px){.project-post article h1{font-size:28px}}.project-post article h2{font-size:28px;margin-top:1.5em;margin-bottom:.8em}@media(max-width:480px){.project-post article h2{font-size:24px}}.project-post article h3{font-size:24px;margin-top:1.5em;margin-bottom:.5em}@media(max-width:480px){.project-post article h3{font-size:20px}}.project-post article h4{font-size:20px;margin-top:1.5em;margin-bottom:.5em}@media(max-width:480px){.project-post article h4{font-size:18px}}.project-post article h5{font-size:18px;margin-top:1.5em;margin-bottom:.5em}@media(max-width:480px){.project-post article h5{font-size:16px}}.project-post article p{color:hsla(0,0%,100%,.72);line-height:1.75;margin-top:0;margin-bottom:1em;transition:font-size .3s ease-out}@media(max-width:480px){.project-post article p{font-size:14px}}.project-post article a{color:#fff;text-decoration:none;font-size:16px;font-weight:500}.project-post article a:hover{text-decoration:underline}.project-post article section{position:relative}.project-post article .gatsby-resp-image-wrapper,.project-post article>img,.project-post article section img{max-width:100%;margin-bottom:15px}.project-post article .gatsby-resp-image-wrapper.img-block,.project-post article>img.img-block,.project-post article section img.img-block{display:block;width:100%}.project-post article a::selection,.project-post article h1::selection,.project-post article h2::selection,.project-post article h3::selection,.project-post article h4::selection,.project-post article h5::selection,.project-post article h6::selection,.project-post article img::selection,.project-post article li::selection,.project-post article p::selection,.project-post article span::selection,.project-post article td::selection,.project-post article th::selection{background-color:#fff;color:#000}</style><meta name="generator" content="Gatsby 2.23.3"/><link rel="icon" href="/favicon-32x32.png?v=313d9008ee8fe081abb89db0cb2403f4"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#000"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=313d9008ee8fe081abb89db0cb2403f4"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=313d9008ee8fe081abb89db0cb2403f4"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=313d9008ee8fe081abb89db0cb2403f4"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=313d9008ee8fe081abb89db0cb2403f4"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=313d9008ee8fe081abb89db0cb2403f4"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=313d9008ee8fe081abb89db0cb2403f4"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=313d9008ee8fe081abb89db0cb2403f4"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=313d9008ee8fe081abb89db0cb2403f4"/><title data-react-helmet="true">【译】React 如何区分 Class 和 Function？ | 博客 | 童话说</title><meta data-react-helmet="true" name="description" content="Washington Hua 的个人博客，专注大前端技术"/><meta data-react-helmet="true" property="og:title" content="【译】React 如何区分 Class 和 Function？ | 博客 | 童话说"/><meta data-react-helmet="true" property="og:description" content="Washington Hua 的个人博客，专注大前端技术"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Washington Hua"/><meta data-react-helmet="true" name="twitter:title" content="【译】React 如何区分 Class 和 Function？ | 博客"/><meta data-react-helmet="true" name="twitter:description" content="Washington Hua 的个人博客，专注大前端技术"/><meta data-react-helmet="true" name="keywords" content="thewashingtonhua,github,front-end,javascript,typescript,react,node,washington,hua,童话,童话说,前端,博客,技术,计算机,互联网,react"/><link as="script" rel="preload" href="/webpack-runtime-dc76cbb15897f0f186de.js"/><link as="script" rel="preload" href="/framework-64e69fd68d379a9aab8f.js"/><link as="script" rel="preload" href="/app-a2411d385eb32966b786.js"/><link as="script" rel="preload" href="/styles-823ae8103e36ae8a7f9f.js"/><link as="script" rel="preload" href="/commons-ed4ec27308bc755c1737.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-dae5297354ebfb8266f2.js"/><link as="fetch" rel="preload" href="/page-data/blog/2019/03/06/how-does-react-tell-a-class-from-a-function/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><header id="mf-header"><div class="mf-header-container"><div class="mf-header-wrapper"><div class="brand"><a class="brand-link" href="/"><img class="brand-logo" src="/static/logo-8503f6989dba3ce27939964a48c8b787.png" alt=""/><span class="brand-name">童话说</span></a></div><div class="navigation"><nav class="nav-menu"><ul class="menus"><li class="menu"><a class="menu-link active" href="/blog">博客</a></li><li class="menu"><a class="menu-link" href="/project">项目</a></li><li class="menu"><a class="menu-link" href="/toolbox">工具</a></li><li class="menu"><a class="menu-link" href="/friend">友人</a></li><li class="menu"><a class="menu-link" href="/about">关于</a></li></ul></nav></div><div class="navigation-mobile"><div class="hamberger" data-is-open="false"></div><nav class="nav-menu" data-is-open="false"><ul class="menus"><li class="menu"><a class="menu-link active" href="/blog">博客</a></li><li class="menu"><a class="menu-link" href="/project">项目</a></li><li class="menu"><a class="menu-link" href="/toolbox">工具</a></li><li class="menu"><a class="menu-link" href="/friend">友人</a></li><li class="menu"><a class="menu-link" href="/about">关于</a></li></ul></nav></div></div><div class="search-bar"><div class="wrapper"><div class="search-input"><div class="search-input__icon"><svg t="1570778823962" class="icon" viewBox="0 0 1024 1024" version="1.1" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M898.036124 852.92674 748.500389 703.389982c49.522903-62.73788 79.244832-142.968156 79.244832-230.408647 0-200.905706-156.887167-363.772051-350.416881-363.772051S126.911458 272.075629 126.911458 472.981335s156.887167 363.772051 350.416881 363.772051c78.338183 0 150.670581-26.688849 209.025641-71.782883l149.819191 149.819191L898.036124 852.92674zM476.93232 751.116983c-147.9711 0-267.924075-124.526131-267.924075-278.135648s119.953999-278.135648 267.924075-278.135648 267.924075 124.526131 267.924075 278.135648S624.903419 751.116983 476.93232 751.116983z"></path></svg></div><input type="text" class="search-input__input" placeholder="搜索「童话说」" value=""/></div><div class="search-result"><div class="result-container"><p class="placeholder">请开始你的搜索</p></div></div></div></div></div><div class="mf-header-placeholder"></div></header><main id="mf-main"><div class="mf-content blog-post"><p class="back-to-parent"><a href="/blog">« 回到博客列表</a></p><article class="" id="blog__how-does-react-tell-a-class-from-a-function"><h1 class="post-title">【译】React 如何区分 Class 和 Function？</h1><p class="metas"><span class="meta">Mar 6th, 2019</span><span class="meta">阅读本文大约需要 <!-- -->17<!-- --> 分钟</span></p><div class="banner"><img src="/static/9fbf74366dc5b9e4aab57572a9f0470d/overreacted.jpg" alt=""/></div><div class="content-wrapper"><div class="content"><blockquote>
<p>原文地址：<a href="https://overreacted.io/how-does-react-tell-a-class-from-a-function/" target="_blank" rel="noopener noreferrer">How Does React Tell a Class from a Function?</a></p>
<p>原文作者：<a href="https://twitter.com/dan_abramov" target="_blank" rel="noopener noreferrer">Dan Abramov</a></p>
</blockquote>
<p>让我们来看一下这个以函数形式定义的 <code class="gatsby-code-text">Greeting</code> 组件：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>React 也支持将他定义成一个类：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>（直到 <a href="https://reactjs.org/docs/hooks-intro.html" target="_blank" rel="noopener noreferrer">最近</a>，这是使用 state 特性的唯一方式）</p>
<p>当你要渲染一个 <code class="gatsby-code-text">&lt;Greeting /&gt;</code> 组件时，你并不需要关心它是如何定义的：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// 是类还是函数 —— 无所谓</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>但 <strong>React 本身</strong>在意其中的差别！</p>
<p>如果 <code class="gatsby-code-text">Greeting</code> 是一个函数，React 需要调用它。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// 你的代码</span>
<span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在 React 内部</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p>Hello&lt;/p></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>但如果 <code class="gatsby-code-text">Greeting</code> 是一个类，React 需要先用 <code class="gatsby-code-text">new</code> 操作符将其实例化，<strong>然后</strong> 调用刚才生成实例的 <code class="gatsby-code-text">render</code> 方法：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// 你的代码</span>
<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在 React 内部</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Greeting {}</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p>Hello&lt;/p></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>无论哪种情况 React 的目标都是去获取渲染后的节点（在这个案例中，<code class="gatsby-code-<p">Hello&lt;/p</code>）。但具体的步骤取决于 <code class="gatsby-code-text">Greeting</code> 是如何定义的。</p>
<p><strong>所以 React 是怎么知道某样东西是 class 还是 function 的呢？</strong></p>
<p>就像我 <a href="https://overreacted.io/why-do-we-write-super-props/" target="_blank" rel="noopener noreferrer">上一篇博客</a> 中提到的，<strong>你并不需要知道这个才能高效使用 React。</strong> 我几年来都不知道这个。请不要把这变成一道面试题。事实上，这篇博客更多的是关于 JavaScript 而不是 React。</p>
<p>这篇博客是写给那些对 React 具体是 <strong>如何</strong> 工作的表示好奇的读者的。你是那样的人吗？那我们一起深入探讨一下吧。</p>
<p><strong>这将是一段漫长的旅程，系好安全带。这篇文章并没有多少关于 React 本身的信息，但我们会涉及到 <code class="gatsby-code-text">new</code>、<code class="gatsby-code-text">this</code>、<code class="gatsby-code-text">class</code>、箭头函数、<code class="gatsby-code-text">prototype</code>、<code class="gatsby-code-text">__proto__</code>、<code class="gatsby-code-text">instanceof</code> 等方面，以及这些东西是如何在 JavaScript 中一起工作的。幸运的是，你并不需要在使用 React 时一直想着这些，除非你正在实现 React...</strong></p>
<p>（如果你真的很想知道答案，直接翻到最下面。）</p>
<hr>
<p>首先，我们需要理解为什么把函数和类分开处理很重要。注意看我们是怎么使用 <code class="gatsby-code-text">new</code> 操作符来调用一个类的：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// 如果 Greeting 是一个函数</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p>Hello&lt;/p></span>

<span class="token comment">// 如果 Greeting 是一个类</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Greeting {}</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;p>Hello&lt;/p></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>我们来简单看一下 <code class="gatsby-code-text">new</code> 在 JavaScript 是干什么的。</p>
<hr>
<p>在过去，JavaScript 还没有类。但是，你可以使用普通函数来模拟。<strong>具体来讲，只要在函数调用前加上 <code class="gatsby-code-text">new</code> 操作符，你就可以把任何函数当做一个类的构造函数来用：</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// 只是一个函数</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Person {name: 'Fred'}</span>
<span class="token keyword">var</span> george <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">'George'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 没用的</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>现在你依然可以这样写！在 DevTools 里试试吧。</p>
<p>如果你调用 <code class="gatsby-code-text">Person(&#39;Fred&#39;)</code> 时 <strong>没有</strong> 加 <code class="gatsby-code-text">new</code>，其中的 <code class="gatsby-code-text">this</code> 会指向某个全局且无用的东西（比如，<code class="gatsby-code-text">window</code> 或者 <code class="gatsby-code-text">undefined</code>），因此我们的代码会崩溃，或者做一些像设置 <code class="gatsby-code-text">window.name</code> 之类的傻事。</p>
<p>通过在调用前增加 <code class="gatsby-code-text">new</code>，我们说：“嘿 JavaScript，我知道 <code class="gatsby-code-text">Person</code> 只是个函数，但让我们假装它是个构造函数吧。<strong>创建一个 <code class="gatsby-code-text">{}</code> 对象并把 <code class="gatsby-code-text">Person</code> 中的 <code class="gatsby-code-text">this</code> 指向那个对象，以便我可以通过类似 <code class="gatsby-code-text">this.name</code> 的形式去设置一些东西，然后把这个对象返回给我。</strong>”</p>
<p>这就是 <code class="gatsby-code-text">new</code> 操作符所做的事。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">var</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 和 `Person` 中的 `this` 等效的对象</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p><code class="gatsby-code-text">new</code> 操作符同时也把我们放在 <code class="gatsby-code-text">Person.prototype</code> 上的东西放到了 <code class="gatsby-code-text">fred</code> 对象上：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hi, I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fred<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这就是在 JavaScript 直接支持类之前，人们模拟类的方式。</p>
<hr>
<p><code class="gatsby-code-text">new</code> 在 JavaScript 中已经存在了好久了，然而类还只是最近的事，它的出现让我们能够重构我们前面的代码以使它更符合我们的本意：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hi, I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fred<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><strong>捕捉开发者的本意</strong> 是语言和 API 设计中非常重要的一点。</p>
<p>如果你写了一个函数，JavaScript 没办法判断它应该像 <code class="gatsby-code-text">alert()</code> 一样被调用，还是应该被视作像 <code class="gatsby-code-text">new Person()</code> 一样的构造函数。忘记给像 <code class="gatsby-code-text">Person</code> 这样的函数指定 <code class="gatsby-code-text">new</code> 会导致令人费解的行为。</p>
<p><strong>类语法允许我们说：“这不仅仅是个函数 —— 这是个类并且它有构造函数”。</strong> 如果你在调用它时忘了加 <code class="gatsby-code-text">new</code>，JavaScript 会报错：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">let</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ✅  如果 Person 是个函数：有效</span>
<span class="token comment">// ✅  如果 Person 是个类：依然有效</span>

<span class="token keyword">let</span> george <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">'George'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 我们忘记使用 `new`</span>
<span class="token comment">// 😳 如果 Person 是个长得像构造函数的方法：令人困惑的行为</span>
<span class="token comment">// 🔴 如果 Person 是个类：立即失败</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这可以帮助我们在早期捕捉错误，而不会遇到类似 <code class="gatsby-code-text">this.name</code> 被当成 <code class="gatsby-code-text">window.name</code> 对待而不是 <code class="gatsby-code-text">george.name</code> 的隐晦错误。</p>
<p>然而，这意味着 React 需要在调用所有类之前加上 <code class="gatsby-code-text">new</code>，而不能把它直接当做一个常规的函数去调用，因为 JavaScript 会把它当做一个错误对待！</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 🔴 React 不能简单这么做：</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">Counter</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这意味着麻烦。</p>
<hr>
<p>在我们看到 React 如何处理这个问题之前，很重要的一点就是要记得大部分 React 的用户会使用 Babel 等编译器来编译类等现代化的特性以便能在老旧的浏览器上运行。因此我们需要在我们的设计中考虑编译器。</p>
<p>在 Babel 的早期版本中，类不加 <code class="gatsby-code-text">new</code> 也可以被调用。但这个问题已经被修复了 —— 通过生成额外的代码的方式。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 稍微简化了一下 Babel 的输出：</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Person</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">"Cannot call a class as a function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Our code:</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ OK</span>
<span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">'George'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 🔴 无法把类当做函数来调用</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>你或许已经在你构建出来的包中见过类似的代码，这就是那些 <code class="gatsby-code-text">_classCallCheck</code> 函数做的事。（你可以通过启用“loose mode”来关闭检查以减小构建包的尺寸，但这或许会使你最终转向真正的原生类时变得复杂）</p>
<hr>
<p>至此，你应该已经大致理解了调用时加不加 <code class="gatsby-code-text">new</code> 的差别：</p>
<table>
<thead>
<tr>
<th></th>
<th><code class="gatsby-code-text">new Person()</code></th>
<th><code class="gatsby-code-text">Person()</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="gatsby-code-text">class</code></td>
<td>✅ <code class="gatsby-code-text">this</code> 是一个 <code class="gatsby-code-text">Person</code> 实例</td>
<td>🔴 <code class="gatsby-code-text">TypeError</code></td>
</tr>
<tr>
<td><code class="gatsby-code-text">function</code></td>
<td>✅ <code class="gatsby-code-text">this</code> 是一个 <code class="gatsby-code-text">Person</code> 实例</td>
<td>😳 <code class="gatsby-code-text">this</code> 是 <code class="gatsby-code-text">window</code> 或 <code class="gatsby-code-text">undefined</code></td>
</tr>
</tbody>
</table>
<p>这就是 React 正确调用你的组件很重要的原因。 <strong>如果你的组件被定义为一个类，React 需要使用 <code class="gatsby-code-text">new</code> 来调用它</strong></p>
<p>所以 React 能检查出某样东西是否是类吗？</p>
<p>没那么容易！即便我们能够 <a href="https://stackoverflow.com/questions/29093396/how-do-you-check-the-difference-between-an-ecmascript-6-class-and-function" target="_blank" rel="noopener noreferrer">在 JavaScript 中区分类和函数</a>，面对被 Babel 等工具处理过的类这还是没用。对浏览器而言，它们只是不同的函数。这是 React 的不幸。</p>
<hr>
<p>好，那 React 可以直接在每次调用时都加上 <code class="gatsby-code-text">new</code> 吗？很遗憾，这种方法并不总是有用。</p>
<p>对于常规函数，用 <code class="gatsby-code-text">new</code> 调用会给它们一个 <code class="gatsby-code-text">this</code> 作为对象实例。对于用作构造函数的函数（比如我们前面提到的 <code class="gatsby-code-text">Person</code>）是可取的，但对函数组件这或许就比较令人困惑了：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 我们并不期望 `this` 在这里表示任何类型的实例</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>这暂且还能忍，还有两个 <strong>其他</strong> 理由会扼杀这个想法。</p>
<hr>
<p>关于为什么总是使用 <code class="gatsby-code-text">new</code> 是没用的的第一个理由是，对于原生的箭头函数（不是那些被 Babel 编译过的），用 <code class="gatsby-code-text">new</code> 调用会抛出一个错误：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Greeting</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🔴 Greeting 不是一个构造函数</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>这个行为是遵循箭头函数的设计而刻意为之的。箭头函数的一个附带作用是它 <strong>没有</strong> 自己的 <code class="gatsby-code-text">this</code> 值 —— <code class="gatsby-code-text">this</code> 解析自离得最近的常规函数：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">Friends</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> friends <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>friends<span class="token punctuation">;</span>
    <span class="token keyword">return</span> friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">friend</span> <span class="token operator">=></span>
      <span class="token operator">&lt;</span>Friend
        <span class="token comment">// `this` 解析自 `render` 方法</span>
        size<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>size<span class="token punctuation">}</span>
        name<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span>name<span class="token punctuation">}</span>
        key<span class="token operator">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">}</span>
      <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>OK，所以 <strong>箭头函数没有自己的 <code class="gatsby-code-text">this</code>。</strong>但这意味着它作为构造函数是完全无用的！</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Person</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 🔴 这么写是没有意义的！</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>因此，<strong>JavaScript 不允许用 <code class="gatsby-code-text">new</code> 调用箭头函数。</strong> 如果你这么做，你或许已经犯了错，最好早点告诉你。这和 JavaScript 不让你 <strong>不加</strong> <code class="gatsby-code-text">new</code> 去调用一个类是类似的。</p>
<p>这样很不错，但这也让我们的计划受阻。React 不能简单对所有东西都使用 <code class="gatsby-code-text">new</code>，因为会破坏箭头函数！我们可以利用箭头函数没有 <code class="gatsby-code-text">prototype</code> 的特点来检测箭头函数，不对它们使用 <code class="gatsby-code-text">new</code>：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prototype <span class="token comment">// undefined</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prototype <span class="token comment">// {constructor: f}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>但这对于被 Babel 编译过的函数是 <a href="https://github.com/facebook/react/issues/4599#issuecomment-136562930" target="_blank" rel="noopener noreferrer">没用</a> 的。这或许没什么大不了，但还有另一个原因使得这条路不会有结果。</p>
<hr>
<p>另一个我们不能总是使用 <code class="gatsby-code-text">new</code> 的原因是它会妨碍 React 支持返回字符串或其它原始类型的组件。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 'Hello'</span>
<span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😳 Greeting {}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这，再一次，和 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new" target="_blank" rel="noopener noreferrer"><code class="gatsby-code-text">new</code> 操作符</a> 的怪异设计有关。如我们之前所看到的，<code class="gatsby-code-text">new</code> 告诉 JavaScript 引擎去创建一个对象，让这个对象成为函数内部的 <code class="gatsby-code-text">this</code>，然后把这个对象作为 <code class="gatsby-code-text">new</code> 的结果给我们。</p>
<p>然而，JavaScript 也允许一个使用 <code class="gatsby-code-text">new</code> 调用的函数返回另一个对象以 <strong>覆盖</strong> <code class="gatsby-code-text">new</code> 的返回值。或许，这在我们利用诸如“对象池模式”来对组件进行复用时是被认为有用的：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// 创建了一个懒变量 zeroVector = null;</span>
<span class="token keyword">function</span> <span class="token function">Vector</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>zeroVector <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 复用同一个实例</span>
      <span class="token keyword">return</span> zeroVector<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    zeroVector <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😲 b === c</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>然而，如果一个函数的返回值 <strong>不是</strong> 一个对象，它会被 <code class="gatsby-code-text">new</code> <strong>完全忽略</strong>。如果你返回了一个字符串或数字，就好像完全没有 <code class="gatsby-code-text">return</code> 一样。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 42</span>
<span class="token keyword">new</span> <span class="token class-name">Answer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😳 Answer {}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>当使用 <code class="gatsby-code-text">new</code> 调用函数时，是没办法读取原始类型（例如一个数字或字符串）的返回值的。因此如果 React 总是使用 <code class="gatsby-code-text">new</code>，就没办法增加对返回字符串的组件的支持！</p>
<p>这是不可接受的，因此我们必须妥协。</p>
<hr>
<p>至此我们学到了什么？React 在调用类（包括 Babel 输出的）时 <strong>需要用</strong> <code class="gatsby-code-text">new</code>，但在调用常规函数或箭头函数时（包括 Babel 输出的）<strong>不需要用</strong> <code class="gatsby-code-text">new</code>，并且没有可靠的方法来区分这些情况。</p>
<p><strong>如果我们没法解决一个笼统的问题，我们能解决一个具体的吗？</strong></p>
<p>当你把一个组件定义为类，你很可能会想要扩展 <code class="gatsby-code-text">React.Component</code> 以便获取内置的方法，比如 <code class="gatsby-code-text">this.setState()</code>。 <strong>与其试图检测所有的类，我们能否只检测 <code class="gatsby-code-text">React.Component</code> 的后代呢？</strong></p>
<p>剧透：React 就是这么干的。</p>
<hr>
<p>或许，检查 <code class="gatsby-code-text">Greeting</code> 是否是一个 React 组件类的最符合语言习惯的方式是测试 <code class="gatsby-code-text">Greeting.prototype instanceof React.Component</code>：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">B</span><span class="token punctuation">.</span>prototype <span class="token keyword">instanceof</span> <span class="token class-name">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>我知道你在想什么，刚才发生了什么？！为了回答这个问题，我们需要理解 JavaScript 原型。</p>
<p>你或许对“原型链”很熟悉。JavaScript 中的每一个对象都有一个“原型”。当我们写 <code class="gatsby-code-text">fred.sayHi()</code> 但 <code class="gatsby-code-text">fred</code> 对象没有 <code class="gatsby-code-text">sayHi</code> 属性，我们尝试到 <code class="gatsby-code-text">fred</code> 的原型上去找 <code class="gatsby-code-text">sayHi</code> 属性。要是我们在这儿找不到，就去找原型链的下一个原型 —— <code class="gatsby-code-text">fred</code> 的原型的原型，以此类推。</p>
<p><strong>费解的是，一个类或函数的 <code class="gatsby-code-text">prototype</code> 属性 <em>并不</em> 指向那个值的原型。</strong> 我没开玩笑。</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 🤪 不是 Person 的原型</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 😳 Person 的原型</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>因此“原型链”更像是 <code class="gatsby-code-text">__proto__.__proto__.__proto__</code> 而不是 <code class="gatsby-code-text">prototype.prototype.prototype</code>，我花了好几年才搞懂这一点。</p>
<p>那么函数和类的 <code class="gatsby-code-text">prototype</code> 属性又是什么？<strong>是用 <code class="gatsby-code-text">new</code> 调用那个类或函数生成的所有对象的 <code class="gatsby-code-text">__proto__</code> ！</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hi, I am '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> fred <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Fred'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置 `fred.__proto__` 为 `Person.prototype`</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>那个 <code class="gatsby-code-text">__proto__</code> 链才是 JavaScript 用来查找属性的：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx">fred<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 1. fred 有 sayHi 属性吗？不。</span>
<span class="token comment">// 2. fred.__proto__ 有 sayHi 属性吗？是的，调用它！</span>

fred<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 1. fred 有 toString 属性吗？不。</span>
<span class="token comment">// 2. fred.__proto__ 有 toString 属性吗？不。</span>
<span class="token comment">// 3. fred.__proto__.__proto__ 有 toString 属性吗？是的，调用它！</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>在实战中，你应该几乎永远不需要直接在代码里动到 <code class="gatsby-code-text">__proto__</code> 除非你在调试和原型链相关的问题。如果你想让某样东西在 <code class="gatsby-code-text">fred.__proto__</code> 上可用，你应该把它放在 <code class="gatsby-code-text">Person.prototype</code>，至少它最初是这么设计的。</p>
<p><code class="gatsby-code-text">__proto__</code> 属性甚至一开始就不应该被浏览器暴露出来，因为原型链应该被视为一个内部概念，然而某些浏览器增加了 <code class="gatsby-code-text">__proto__</code> 并最终勉强被标准化（但已被废弃并推荐使用 <code class="gatsby-code-text">Object.getPrototypeOf()</code>）。</p>
<p><strong>然而一个名叫“原型”的属性却给不了我一个值的“原型”这一点还是很让我困惑</strong>（例如，<code class="gatsby-code-text">fred.prototype</code> 是未定义的，因为 <code class="gatsby-code-text">fred</code> 不是一个函数）。个人观点，我觉得这是即便有经验的开发者也容易误解 JavaScript 原型链的最大原因。</p>
<hr>
<p>这篇博客很长，是吧？已经到 80% 了，坚持住。</p>
<p>我们知道当说 <code class="gatsby-code-text">obj.foo</code> 的时候，JavaScript 事实上会沿着 <code class="gatsby-code-text">obj</code>, <code class="gatsby-code-text">obj.__proto__</code>, <code class="gatsby-code-text">obj.__proto__.__proto__</code> 等等一路寻找 <code class="gatsby-code-text">foo</code>。</p>
<p>在使用类时，你并非直接面对这一机制，但 <code class="gatsby-code-text">extends</code> 的原理依然是基于这项老旧但有效的原型链机制。这也是的我们的 React 类实例能够访问如 <code class="gatsby-code-text">setState</code> 这样方法的原因：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Greeting.prototype</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// React.Component.prototype</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Object.prototype</span>

c<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 在 c.__proto__ (Greeting.prototype) 上找到</span>
c<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 在 c.__proto__.__proto__ (React.Component.prototype) 上找到</span>
c<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 在 c.__proto__.__proto__.__proto__ (Object.prototype) 上找到</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>换句话说，<strong>当你在使用类的时候，实例的 <code class="gatsby-code-text">__proto__</code> 链“镜像”了类的层级结构：</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// `extends` 链</span>
Greeting
  → React<span class="token punctuation">.</span>Component
    → <span class="token function">Object</span> <span class="token punctuation">(</span>间接的<span class="token punctuation">)</span>

<span class="token comment">// `__proto__` 链</span>
<span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  → <span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype
    → React<span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">.</span>prototype
      → <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>2 条链。</p>
<hr>
<p>既然 <code class="gatsby-code-text">__proto__</code> 链镜像了类的层级结构，我们可以检查一个 <code class="gatsby-code-text">Greeting</code> 是否扩展了 <code class="gatsby-code-text">React.Component</code>，我们从 <code class="gatsby-code-text">Greeting.prototype</code> 开始，一路沿着 <code class="gatsby-code-text">__proto__</code> 链：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// `__proto__` chain</span>
<span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  → <span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype <span class="token comment">// 🕵️ 我们从这儿开始</span>
    → React<span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">.</span>prototype <span class="token comment">// ✅ 找到了！</span>
      → <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>方便的是，<code class="gatsby-code-text">x instanceof Y</code> 做的就是这类搜索。它沿着 <code class="gatsby-code-text">x.__proto__</code> 链寻找 <code class="gatsby-code-text">Y.prototype</code> 是否在那儿。</p>
<p>通常，这被用来判断某样东西是否是一个类的实例：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token keyword">let</span> greeting <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting <span class="token keyword">instanceof</span> <span class="token class-name">Greeting</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// greeting (🕵️‍ 我们从这儿开始)</span>
<span class="token comment">//   .__proto__ → Greeting.prototype (✅ 找到了！)</span>
<span class="token comment">//     .__proto__ → React.Component.prototype</span>
<span class="token comment">//       .__proto__ → Object.prototype</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting <span class="token keyword">instanceof</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// greeting (🕵️‍ 我们从这儿开始)</span>
<span class="token comment">//   .__proto__ → Greeting.prototype</span>
<span class="token comment">//     .__proto__ → React.Component.prototype (✅ 找到了！)</span>
<span class="token comment">//       .__proto__ → Object.prototype</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// greeting (🕵️‍ 我们从这儿开始)</span>
<span class="token comment">//   .__proto__ → Greeting.prototype</span>
<span class="token comment">//     .__proto__ → React.Component.prototype</span>
<span class="token comment">//       .__proto__ → Object.prototype (✅ 找到了！)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>greeting <span class="token keyword">instanceof</span> <span class="token class-name">Banana</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
<span class="token comment">// greeting (🕵️‍ 我们从这儿开始)</span>
<span class="token comment">//   .__proto__ → Greeting.prototype</span>
<span class="token comment">//     .__proto__ → React.Component.prototype</span>
<span class="token comment">//       .__proto__ → Object.prototype (🙅‍ 没找到！)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>但这用来判断一个类是否扩展了另一个类还是有效的</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype <span class="token keyword">instanceof</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// greeting</span>
<span class="token comment">//   .__proto__ → Greeting.prototype (🕵️‍ 我们从这儿开始)</span>
<span class="token comment">//     .__proto__ → React.Component.prototype (✅ 找到了！)</span>
<span class="token comment">//       .__proto__ → Object.prototype</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这种检查方式就是我们判断某样东西是一个 React 组件类还是一个常规函数的方式。</p>
<hr>
<p>然而 React 并不是这么做的 😳</p>
<p>关于 <code class="gatsby-code-text">instanceof</code> 解决方案有一点附加说明，当页面上有多个 React 副本，并且我们要检查的组件继承自 <strong>另一个</strong> React 副本的 <code class="gatsby-code-text">React.Component</code> 时，这种方法是无效的。在一个项目里混合多个 React 副本是不好的，原因有很多，但站在历史角度来看，我们试图尽可能避免问题。（有了 Hooks，我们 <a href="https://github.com/facebook/react/issues/13991" target="_blank" rel="noopener noreferrer">或许得</a> 强制避免重复）</p>
<p>另一点启发可以是去检查原型链上的 <code class="gatsby-code-text">render</code> 方法。然而，当时还 <a href="https://github.com/facebook/react/issues/4599#issuecomment-129714112" target="_blank" rel="noopener noreferrer">不确定</a> 组件的 API 会如何演化。每一次检查都有成本，所以我们不想再多加了。如果 <code class="gatsby-code-text">render</code> 被定义为一个实例方法，例如使用类属性语法，这个方法也会失效。</p>
<p>因此, React 为基类 <a href="https://github.com/facebook/react/pull/4663" target="_blank" rel="noopener noreferrer">增加了</a> 一个特别的标记。React 检查是否有这个标记，以此知道某样东西是否是一个 React 组件类。</p>
<p>最初这个标记是在 <code class="gatsby-code-text">React.Component</code> 这个基类自己身上：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// 在 React 内部</span>
<span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Component<span class="token punctuation">.</span>isReactClass <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 我们可以像这样检查它</span>
<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Greeting<span class="token punctuation">.</span>isReactClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 是的</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>然而，有些我们希望作为目标的类实现 <a href="https://github.com/scala-js/scala-js/issues/1900" target="_blank" rel="noopener noreferrer">并没有</a> 复制静态属性（或设置非标准的 <code class="gatsby-code-text">__proto__</code>），标记也因此丢失。</p>
<p>这也是为什么 React 把这个标记 <a href="https://github.com/facebook/react/pull/5021" target="_blank" rel="noopener noreferrer">移动到了</a> <code class="gatsby-code-text">React.Component.prototype</code>：</p>
<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="gatsby-code-jsx line-numbers"><code class="gatsby-code-jsx"><span class="token comment">// 在 React 内部</span>
<span class="token keyword">class</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Component</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isReactComponent <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 我们可以像这样检查它</span>
<span class="token keyword">class</span> <span class="token class-name">Greeting</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Greeting</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>isReactComponent<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 是的</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><strong>说真的这就是全部了。</strong></p>
<p>你或许奇怪为什么是一个对象而不是一个布尔值。实战中这并不重要，但早期版本的 Jest（在 Jest 商品化之前）是默认开始自动模拟功能的，生成的模拟数据省略掉了原始类型属性，<a href="https://github.com/facebook/react/pull/4663#issuecomment-136533373" target="_blank" rel="noopener noreferrer">破坏了检查</a>。真是谢谢了，Jest。</p>
<p>一直到今天，<a href="https://github.com/facebook/react/blob/769b1f270e1251d9dbdce0fcbd9e92e502d059b8/packages/react-reconciler/src/ReactFiber.js#L297-L300" target="_blank" rel="noopener noreferrer">React 都在用</a> <code class="gatsby-code-text">isReactComponent</code> 进行检查。</p>
<p>如果你不扩展 <code class="gatsby-code-text">React.Component</code>，React 不会在原型上找到 <code class="gatsby-code-text">isReactComponent</code>，因此就不会把组件当做类处理。现在你知道为什么解决 <code class="gatsby-code-text">Cannot call a class as a function</code> 错误的 <a href="https://stackoverflow.com/a/42680526/458193" target="_blank" rel="noopener noreferrer">得票数最高的答案</a> 是增加 <code class="gatsby-code-text">extends React.Component</code>。最后，我们还 <a href="https://github.com/facebook/react/pull/11168" target="_blank" rel="noopener noreferrer">增加了一项警告</a>，当 <code class="gatsby-code-text">prototype.render</code> 存在但 <code class="gatsby-code-text">prototype.isReactComponent</code> 不存在时会发出警告。</p>
<hr>
<p>你或许会觉得这个故事有一点“标题党”。 <strong>实际的解决方案其实真的很简单，但我花了大量的篇幅在转折上来解释为什么 React 最终选择了这套方案，以及还有哪些候选方案。</strong></p>
<p>以我的经验来看，设计一个库的 API 也经常会遇到这种情况。为了一个 API 能够简单易用，你经常需要考虑语义化（可能的话，为多种语言考虑，包括未来的发展方向）、运行时性能、有或没有编译时步骤的工程效能、生态的状态以及打包方案、早期的警告，以及很多其它问题。最终的结果未必总是最优雅的，但必须要是可用的。</p>
<p><strong>如果最终的 API 成功的话, <em>它的用户</em> 永远不必思考这一过程</strong>。他们只需要专心创建应用就好了。</p>
<p>但如果你同时也很好奇...知道它是怎么工作的也是极好的。</p></div></div><section class="series"><header class="header"><p class="title">该系列的其他文章</p></header><ul class="posts"><li class="post"><a class="" href="/blog/2019/02/22/why-do-we-write-super-props">【译】我们为什么要写 super(props)?</a></li></ul></section></article></div></main><footer id="mf-footer"><div class="copyright"><p><span>Developed with</span><svg t="1570766298594" class="icon" viewBox="0 0 1024 1024" version="1.1" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M939.664 148.352C885.248 93.968 812.944 64 736 64s-138.592 27.632-192.976 82.016l-0.096 0.08-0.032 0.016L512 185.04l-30.912-36.576-0.096-0.096-0.016-0.016C426.576 93.968 364.928 64 288 64S138.752 93.968 84.352 148.352C29.952 202.752 0 275.072 0 352c0 76.896 29.92 149.168 84.256 203.568L466.56 941.056a63.952 63.952 0 0 0 90.88 0l382.288-385.472A286.176 286.176 0 0 0 1024 352c0-76.928-29.952-149.248-84.336-203.648z" fill="#d81e06"></path></svg><span>by <!-- -->&lt;Washington Hua /&gt;</span></p><p>© 2014 - <!-- -->2021<!-- --> All Rights Reserved</p></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2019/03/06/how-does-react-tell-a-class-from-a-function";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a2411d385eb32966b786.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-3d7a28637eaf362985e2.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-26c9b50b33f08d3a202c.js"],"component---src-pages-blog-tsx":["/component---src-pages-blog-tsx-3d930f6733b9bf92dd1d.js"],"component---src-pages-draft-tsx":["/component---src-pages-draft-tsx-a2066319cfefc375e51e.js"],"component---src-pages-friend-tsx":["/component---src-pages-friend-tsx-1235cc664fb0114a8273.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-3231cc383912c2b4f28c.js"],"component---src-pages-project-tsx":["/component---src-pages-project-tsx-5709f1054584cad73d9c.js"],"component---src-pages-toolbox-browser-keyboard-tsx":["/component---src-pages-toolbox-browser-keyboard-tsx-3899574a4f8c8746dcb1.js"],"component---src-pages-toolbox-browser-ua-tsx":["/component---src-pages-toolbox-browser-ua-tsx-ae478f613f1345e0d7d8.js"],"component---src-pages-toolbox-browser-viewport-tsx":["/component---src-pages-toolbox-browser-viewport-tsx-c3ef2259fd0d5f1c7494.js"],"component---src-pages-toolbox-device-data-tsx":["/component---src-pages-toolbox-device-data-tsx-6a8811fbf1c367f92ab4.js"],"component---src-pages-toolbox-html-5-canvas-tsx":["/component---src-pages-toolbox-html-5-canvas-tsx-7cd7bcb3022a5b1598e9.js"],"component---src-pages-toolbox-html-5-connection-tsx":["/component---src-pages-toolbox-html-5-connection-tsx-bbec425e7f444205778f.js"],"component---src-pages-toolbox-html-5-geolocation-tsx":["/component---src-pages-toolbox-html-5-geolocation-tsx-f2c361a0c65af7a680a3.js"],"component---src-pages-toolbox-html-5-input-tsx":["/component---src-pages-toolbox-html-5-input-tsx-4c8194f5cddd3b443d93.js"],"component---src-pages-toolbox-html-5-online-tsx":["/component---src-pages-toolbox-html-5-online-tsx-a7993d94d22006ffd851.js"],"component---src-pages-toolbox-tsx":["/component---src-pages-toolbox-tsx-a0693ffa2bbe4d58e72a.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-dae5297354ebfb8266f2.js"],"component---src-templates-project-post-tsx":["/component---src-templates-project-post-tsx-ff9c2b3725bc97ff4bfd.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-tsx-dae5297354ebfb8266f2.js" async=""></script><script src="/commons-ed4ec27308bc755c1737.js" async=""></script><script src="/styles-823ae8103e36ae8a7f9f.js" async=""></script><script src="/app-a2411d385eb32966b786.js" async=""></script><script src="/framework-64e69fd68d379a9aab8f.js" async=""></script><script src="/webpack-runtime-dc76cbb15897f0f186de.js" async=""></script></body></html>