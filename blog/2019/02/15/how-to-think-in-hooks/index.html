<!DOCTYPE html><html lang="zh"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge,chrome=1"/><meta http-equiv="render" content="webkit"/><meta http-equiv="force-rendering" content="webkit"/><meta http-equiv="format-detection" content="telephone=no"/><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, userscalable=no, shrink-to-fit=no, viewport-fit=cover"/><style data-href="/component---src-templates-blog-post-js.4d8ea8422d861346776c.css">#mf-header{position:fixed;top:0;left:0;width:100%;height:44px;background-color:#000;z-index:10;box-shadow:0 0 2px 2px rgba(0,0,0,.5)}#mf-header .mf-header-wrapper{width:100%;max-width:960px;height:100%;margin:0 auto;display:-webkit-flex;display:flex;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;align-items:center;padding-left:15px;padding-right:15px;transition:max-width .3s ease-out}@media (max-width:1280px){#mf-header .mf-header-wrapper{max-width:768px}}#mf-header .mf-header-wrapper .logo{height:44px;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center}#mf-header .mf-header-wrapper .logo img{height:32px;margin-right:15px}#mf-header .mf-header-wrapper .logo span{display:block;font-size:20px;height:44px;line-height:44px;color:hsla(0,0%,100%,.84);transition:color .3s ease-out,font-size .3s ease-out}@media (max-width:480px){#mf-header .mf-header-wrapper .logo span{font-size:16px}}#mf-header .mf-header-wrapper .logo span:hover{color:#fff}#mf-header .mf-header-wrapper .hamberger{width:22px;height:16px;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-justify-content:space-between;justify-content:space-between;border-top:2px solid hsla(0,0%,100%,.84);border-bottom:2px solid hsla(0,0%,100%,.84);position:relative;transition:border-color .3s ease-out;cursor:pointer}#mf-header .mf-header-wrapper .hamberger.open{border-top-color:transparent;border-bottom-color:transparent}#mf-header .mf-header-wrapper .hamberger.open:before{-webkit-transform:translate(-50%,-50%) rotate(-45deg);transform:translate(-50%,-50%) rotate(-45deg)}#mf-header .mf-header-wrapper .hamberger.open:after{-webkit-transform:translate(-50%,-50%) rotate(45deg);transform:translate(-50%,-50%) rotate(45deg)}#mf-header .mf-header-wrapper .hamberger:after,#mf-header .mf-header-wrapper .hamberger:before{content:"";position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:50% 50%;transform-origin:50% 50%;width:100%;height:2px;background-color:hsla(0,0%,100%,.84);transition:-webkit-transform .3s ease-out;transition:transform .3s ease-out;transition:transform .3s ease-out,-webkit-transform .3s ease-out}#mf-header .mf-header-wrapper .nav-menu{position:fixed;top:44px;left:0;right:0;bottom:0;background-color:#000;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;opacity:0;pointer-events:none;z-index:10;transition:opacity .3s ease-out}#mf-header .mf-header-wrapper .nav-menu.open{opacity:1;pointer-events:all}#mf-header .mf-header-wrapper .nav-menu .menus{-webkit-flex-basis:1;flex-basis:1;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-align-items:center;align-items:center}#mf-header .mf-header-wrapper .nav-menu .menus .menu{display:block;width:180px;height:40px;line-height:40px;font-size:16px;color:hsla(0,0%,100%,.54);text-align:center;transition:background-color .3s ease-out}#mf-header .mf-header-wrapper .nav-menu .menus .menu:hover{color:hsla(0,0%,100%,.54)}#mf-header .mf-header-wrapper .nav-menu .menus .menu:not(:first-child){margin-top:15px}#mf-header .mf-header-wrapper .nav-menu .menus .menu.active{color:hsla(0,0%,100%,.84);border-top:1px solid hsla(0,0%,100%,.84);border-bottom:1px solid hsla(0,0%,100%,.84)}#mf-header .mf-header-wrapper .nav-menu .menus .menu.active:hover{color:hsla(0,0%,100%,.84)}#mf-header-placeholder{height:44px}*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Hiragino Sans GB,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Open Sans,Droid Sans,Microsoft YaHei,WenQuanYi Micro Hei,Helvetica Neue,Tahoma,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}body,html{margin:0;padding:0}html{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Hiragino Sans GB,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Open Sans,Droid Sans,Microsoft YaHei,WenQuanYi Micro Hei,Helvetica Neue,Tahoma,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{background-color:#000;-webkit-overflow-scrolling:touch}body,h1,h2,h3,h4,h5,p{margin:0}a,h1,h2,h3,h4,h5,p{font-weight:400}ol,ul{margin:0;padding:0}ul{list-style:none}a{text-decoration:none}.scroll-lock{overflow:hidden}.mf-content{width:100%;max-width:960px;margin:0 auto 30px;transition:max-width .3s ease-out}@media (max-width:1280px){.mf-content{max-width:768px}}@media (max-width:768px){.mf-content{max-width:100%}}main{min-height:calc(100vh - 44px)}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.gatsby-code-text{font-size:.8em;font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace;color:hsla(0,0%,100%,.84);background-color:#181818;padding:.5em;border-radius:6px}.gatsby-highlight{background:#222;color:#fff;border-radius:10px;overflow:auto;-moz-tab-size:1.5em;-o-tab-size:1.5em;tab-size:1.5em;margin-bottom:15px;-webkit-overflow-scrolling:touch;position:relative}.gatsby-highlight pre.line-numbers{padding-left:40px}.gatsby-highlight code,.gatsby-highlight span{font-family:Fira Code,Source Code Pro,Menlo,Monaco,Consolas,Liberation Mono,Simsun,Courier New,monospace}.gatsby-highlight code{color:#ccc}.gatsby-highlight>code[class*=gatsby-code-],.gatsby-highlight>pre.prism-code,.gatsby-highlight>pre[class*=gatsby-code-]{height:auto!important;margin:1rem;font-size:14px;line-height:20px;white-space:pre-wrap;word-break:break-word}.gatsby-highlight+.gatsby-highlight{margin-top:20}.gatsby-highlight .token.attr-name{color:#c684c1}.gatsby-highlight .token.block-comment,.gatsby-highlight .token.cdata,.gatsby-highlight .token.comment,.gatsby-highlight .token.doctype,.gatsby-highlight .token.prolog{color:#666}.gatsby-highlight .token.constant,.gatsby-highlight .token.deleted,.gatsby-highlight .token.function-name,.gatsby-highlight .token.number,.gatsby-highlight .token.property,.gatsby-highlight .token.symbol{color:#5a9bcf}.gatsby-highlight .token.boolean{color:#ff8b50}.gatsby-highlight .token.tag{color:#fc929e}.gatsby-highlight .token.string{color:#8dc891}.gatsby-highlight .token.punctuation{color:#88c6be}.gatsby-highlight .token.builtin,.gatsby-highlight .token.char,.gatsby-highlight .token.inserted,.gatsby-highlight .token.selector{color:#d8dee9}.gatsby-highlight .token.function{color:#efbd54}.gatsby-highlight .token.entity,.gatsby-highlight .token.operator,.gatsby-highlight .token.url,.gatsby-highlight .token.variable{color:#9adcff}.gatsby-highlight .token.attr-value{color:#8dc891}.gatsby-highlight .token.keyword{color:#c684c1}.gatsby-highlight .token.atrule,.gatsby-highlight .token.class-name{color:#fac863}.gatsby-highlight .token.important{font-weight:400}.gatsby-highlight .token.bold{font-weight:700}.gatsby-highlight .token.italic{font-style:italic}.gatsby-highlight .token.entity{cursor:help}.gatsby-highlight .namespace{opacity:.7}.gatsby-highlight-code-line{background-color:#353b45;display:block;margin:-.125rem calc(-1rem - 15px);padding:.125rem calc(1rem + 15px)}.line-numbers-rows>span{line-height:1.5}.gatsby-highlight[data-language]:before{position:absolute;top:0;right:20px;padding:3px 10px;font-size:12px;text-align:right;color:#444;font-weight:700;letter-spacing:.8px;text-transform:uppercase;border-radius:0 0 5px 5px;background:#ddd}.gatsby-highlight[data-language=javascript]:before{content:"js";background:#f7df1e}.gatsby-highlight[data-language=css]:before{content:"css";background:#ff9800;color:#fff;font-weight:400}.gatsby-highlight[data-language=html]:before{content:"html";background:#00a5ff;color:#fff;font-weight:400}.gatsby-highlight[data-language=bash]:before{content:"bash";background:#f6ffe5;font-weight:400}.gatsby-highlight[data-language=json]:before{content:"json";background:#37ff00;font-weight:400}.blog-post .back-to-parent{padding:50px 15px 20px}.blog-post .back-to-parent a{color:hsla(0,0%,100%,.54)}.blog-post article{padding:10px 15px 150px}.blog-post article a::selection,.blog-post article code::selection,.blog-post article h1::selection,.blog-post article h2::selection,.blog-post article h3::selection,.blog-post article h4::selection,.blog-post article h5::selection,.blog-post article img::selection,.blog-post article li::selection,.blog-post article p::selection,.blog-post article span::selection,.blog-post article td::selection,.blog-post article th::selection,.blog-post article time::selection{background-color:hsla(0,0%,100%,.84);color:#000}.blog-post article>h1{color:hsla(0,0%,100%,.84);font-size:36px;font-weight:700;line-height:1.3;margin-bottom:.5em;transition:font-size .3s ease-out;position:relative}@media (max-width:1280px){.blog-post article>h1{font-size:32px}}@media (max-width:768px){.blog-post article>h1{font-size:28px}}@media (max-width:480px){.blog-post article>h1{font-size:24px}}.blog-post article .metas{display:-webkit-flex;display:flex}@media (max-width:480px){.blog-post article .metas{-webkit-flex-direction:column;flex-direction:column}}.blog-post article .metas .publish-date{color:hsla(0,0%,100%,.54);font-size:18px;font-weight:100;line-height:1;position:relative;margin-bottom:0;transition:font-size .3s ease-out,margin-bottom .3s ease-out}@media (max-width:480px){.blog-post article .metas .publish-date{margin-bottom:4px;font-size:14px}}.blog-post article .metas .tags{color:hsla(0,0%,100%,.54);font-size:18px;line-height:1;margin-bottom:0;transition:font-size .3s ease-out;position:relative;padding-left:1em;margin-left:1em}@media (max-width:480px){.blog-post article .metas .tags{font-size:14px}}.blog-post article .metas .tags:after{content:"";position:absolute;top:50%;left:0;-webkit-transform:translateY(-50%);transform:translateY(-50%);width:1px;height:16px;background-color:hsla(0,0%,100%,.54)}@media (max-width:480px){.blog-post article .metas .tags:after{content:none}}.blog-post article .banner{margin:20px 0}.blog-post article .banner img{width:100%;display:block;border-radius:6px}.blog-post article .content h1,.blog-post article .content h2,.blog-post article .content h3,.blog-post article .content h4,.blog-post article .content h5{color:hsla(0,0%,100%,.84);font-weight:700;line-height:1.5;margin-top:1.5em;margin-bottom:.5em;transition:font-size .3s ease-out}.blog-post article .content h1{font-size:32px}@media (max-width:480px){.blog-post article .content h1{font-size:28px}}.blog-post article .content h2{font-size:28px}@media (max-width:480px){.blog-post article .content h2{font-size:24px}}.blog-post article .content h3{font-size:24px}@media (max-width:480px){.blog-post article .content h3{font-size:20px}}.blog-post article .content h4{font-size:20px}@media (max-width:480px){.blog-post article .content h4{font-size:18px}}.blog-post article .content h5{font-size:18px}@media (max-width:480px){.blog-post article .content h5{font-size:16px}}.blog-post article .content p{font-size:15px;color:hsla(0,0%,100%,.54);line-height:1.75;margin-top:0;margin-bottom:1em;transition:font-size .3s ease-out}@media (max-width:480px){.blog-post article .content p{font-size:14px}}.blog-post article .content pre{position:relative;overflow-x:auto;overflow-y:hidden}.blog-post article .content a{color:hsla(0,0%,100%,.84);font-size:15px;word-wrap:break-word}.blog-post article .content a:hover{text-decoration:underline}.blog-post article .content ul{list-style:circle}.blog-post article .content ol,.blog-post article .content ul{padding-left:30px;margin:1em 0}.blog-post article .content ol ol,.blog-post article .content ol ul,.blog-post article .content ul ol,.blog-post article .content ul ul{margin:.5em 0}.blog-post article .content ol li,.blog-post article .content ul li{line-height:1.8;margin-bottom:.5em;color:hsla(0,0%,100%,.54);transition:font-size .3s ease-out}@media (max-width:480px){.blog-post article .content ol li,.blog-post article .content ul li{font-size:14px}}.blog-post article .content table{margin-bottom:15px;min-width:100%;border-collapse:collapse}.blog-post article .content table tr:nth-child(odd){background-color:#292929}.blog-post article .content table tr:nth-child(2n){background-color:#1f1f1f}.blog-post article .content table thead tr:nth-child(odd){background-color:#1f1f1f}.blog-post article .content table td,.blog-post article .content table th{font-size:15px;line-height:1.75;margin-top:0;margin-bottom:1em;padding:15px 20px;text-align:left;word-wrap:normal;color:hsla(0,0%,100%,.54);transition:font-size .3s ease-out}@media (max-width:480px){.blog-post article .content table td,.blog-post article .content table th{font-size:14px}}.blog-post article .content table td a,.blog-post article .content table th a{padding:0}.blog-post article .content blockquote{margin:0 0 .75em;border-left:3px solid hsla(0,0%,100%,.54);background-color:#181818;padding:15px}.blog-post article .content blockquote p{color:hsla(0,0%,100%,.54);font-size:14px;line-height:1.5;margin-bottom:0;font-style:italic}@media (max-width:480px){.blog-post article .content blockquote p{font-size:12px}}.blog-post article .content blockquote p+p{margin-top:.75em}.blog-post article .content hr{margin:50px auto;width:80%;height:1px;background-color:hsla(0,0%,100%,.54);border:none}.blog-post article.draft .title:before{content:"[ \8349\7A3F   ] ";color:red}</style><style data-href="/0.4fc8fa5950cae5ffaf64.css">/*! normalize-scss | MIT/GPLv2 License | bit.ly/normalize-scss */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}main{display:block}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}input{overflow:visible}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;display:table;max-width:100%;padding:0;color:inherit;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}details{display:block}summary{display:list-item}menu{display:block}canvas{display:inline-block}template{display:none}[hidden]{display:none}</style><meta name="generator" content="Gatsby 2.1.2"/><link rel="shortcut icon" href="/icons/icon-48x48.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#000"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><title data-react-helmet="true">如何 Think in Hooks | 博客 | 童话说</title><meta data-react-helmet="true" name="description" content="Washington Hua 的个人博客，专注大前端技术"/><meta data-react-helmet="true" property="og:title" content="如何 Think in Hooks | 博客"/><meta data-react-helmet="true" property="og:description" content="Washington Hua 的个人博客，专注大前端技术"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Washington Hua"/><meta data-react-helmet="true" name="twitter:title" content="如何 Think in Hooks | 博客"/><meta data-react-helmet="true" name="twitter:description" content="Washington Hua 的个人博客，专注大前端技术"/><meta data-react-helmet="true" name="keywords" content="tonghuashuo, github, front-end, javascript, typescript, react, node, washington, hua, 童话, 童话说, 前端, 博客, 技术, 计算机, 互联网"/><link as="script" rel="preload" href="/webpack-runtime-f2e44dcec149a4927514.js"/><link as="script" rel="preload" href="/app-acf18d00bfdc3f0366b6.js"/><link as="script" rel="preload" href="/0-03dbf3f5683c24ff3c45.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-c41e4d2765231522f950.js"/><link as="fetch" rel="preload" href="/static/d/419/path---blog-2019-02-15-how-to-think-in-hooks-119-539-alF8Dm0IC4jAZFf67CKwKeDZE.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><header id="mf-header"><div class="mf-header-wrapper"><a class="logo" href="/"><img src="/static/logo-8503f6989dba3ce27939964a48c8b787.png" alt=""/><span>童话说</span></a><div class="hamberger"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><nav class="nav-menu"><div class="menus"><a class="menu active" href="/blog">博客</a><a class="menu" href="/project">代表作</a><a class="menu" href="/lab">实验室</a><a class="menu" href="/friend">朋友</a><a class="menu" href="/about">我</a></div></nav></div></header><section id="mf-header-placeholder"></section><main><div class="mf-content blog-post"><p class="back-to-parent"><a href="/blog">« 回到博客列表</a></p><article class="" id="blog__how-to-think-in-hooks"><h1 class="title">如何 Think in Hooks</h1><div class="metas"><p class="publish-date"><time dateTime="2019-02-14T16:00:00.000Z">Feb 15, 2019</time></p></div><div class="banner"><img src="/static/think-in-hooks-26d13ef2591ee05a3c4bba7fc34daa88.jpg" alt=""/></div><div class="content"><h2>喜迎 Hooks</h2>
<p>正当中国人民还沉浸在过年的忙碌中，在世界的另一头，React 团队的小伙伴们一点也没闲着，他们写了 <a target='_blank' href='https://reactjs.org/blog/2019/02/06/react-v16.8.0.html'>一篇博客</a> ，并借此正式发布了 Hooks —— 一个官方宣传了好久、开发者们也期待了好久的新特性。</p>
<p>Hooks 正式发布于 v16.8.0，但由于官方团队的 <a target='_blank' href='https://reactjs.org/blog/2018/12/19/react-v-16-7.html'>一点点小失误</a>，在 v16.7.0-alpha.1 中就已经包含了 Hooks 的部分代码。好在 Dan Abramov 之前在 React Conf 上一再强调这还只是实验特性，API 随时有可能会改，欢迎早期反馈，但不建议用于生产环境；官方在事后也及时发文说明了原委，并表示“以后注意”。算是一个小插曲吧，无伤大雅。</p>
<h2>稳住，别急</h2>
<p>最近把 Hooks 部分的文档通读了一遍，加上去年 React Conf 上几个关于 Hooks 的演讲，对 Hooks 的概念及用法有了基本的了解。</p>
<p>作为可能是 React 继 Fiber 之后最大的改变，官方团队真的是慎之又慎。下面这些话摘自 React 官方文档中关于 Hooks 的部分：</p>
<blockquote>
<p>You don’t have to learn Hooks right now.</p>
<p>你不必现在就学习 Hooks。</p>
</blockquote>
<blockquote>
<p>There is no rush to migrate to Hooks. It takes a bit of a mindshift to start “thinking in Hooks”.</p>
<p>不用着急马上迁移到 Hooks，开始“以 Hooks 的方式思考”需要一点点思维上的转变。</p>
</blockquote>
<blockquote>
<p>It is an early time for Hooks, and some third-party libraries might not be compatible with Hooks at the moment.</p>
<p>Hooks 目前尚处于早期阶段，一些第三方库目前可能还不兼容 Hooks。</p>
</blockquote>
<blockquote>
<p>We intend for Hooks to cover all existing use cases for classes, but we will keep supporting class components for the foreseeable future. bla bla bla bla bla bla bla bla bla bla bla bla</p>
<p>我们计划让 Hooks 覆盖 class 的所有现有使用场景，但在可见的未来里我们还是会继续支持 class 组件。</p>
</blockquote>
<blockquote>
<p>There are no plans to remove classes from React.</p>
<p>我们不打算把 class 从 React 中移除。</p>
</blockquote>
<blockquote>
<p>Conceptually, React components have always been closer to functions.</p>
<p>从概念上讲，React 组件一直以来都更接近函数。</p>
</blockquote>
<p>类似的表述在官方文档中随处可见。可以看出，官方对 Hooks 的态度非常明确：<strong><em>未来是属于 Hooks 的</em></strong>。</p>
<p>但路得一步一步走，官方对开发者也是一再表示：</p>
<ol>
<li>Hooks 是可选的，老代码不用改。</li>
<li>Hooks 的概念很新，别着急用。</li>
<li>放心，Class 还在。（至少短期内）</li>
</ol>
<h2>迁移到 Hooks</h2>
<p>相信大部分人在学习 Hooks 时都想过：我已经有一个函数组件 / class 组件了，要怎么把它改造成用 Hooks 实现呢？这个弯要是转不过来，后面的事情就很难办了。</p>
<p>Hooks 的方案，可以简单理解为把 class 独有的东西全都整合到函数组件中去，最终让所有组件变成函数，主要涉及几个方面：</p>
<h3>1. state</h3>
<p>定义一个组件时，到底应该用函数还是用 Class，这是过去大家一直非常关心的问题，最核心的一点就是：组件是否包含 state。</p>
<p>Hooks 通过 <code class="gatsby-code-text">useState()</code> 把 state 引进了函数，并且相比在 Class 中的语法还更加简洁。</p>
<h3>2. 生命周期</h3>
<p>使用 Class 的另一个原因就是生命周期函数，Hooks 去掉了生命周期函数，改为用 <code class="gatsby-code-text">useEffect()</code> 等方法实现。因此如果我们能够给每个生命周期函数都找到对应的解决办法，问题不就解决了嘛。让我们按照这个思路来试一下：</p>
<blockquote>
<p>这里我们只讨论 React 16 开始的新的生命周期方法，<code class="gatsby-code-text">UNSAFE_</code> 开头的方法由于要被废除了，就不再讨论了。</p>
</blockquote>
<h4>2.1. <code class="gatsby-code-text">componentDidUpdate()</code></h4>
<p>Hooks 使用 <code class="gatsby-code-text">useEffect(callback[, depends])</code> 替代 <code class="gatsby-code-text">componentDidUpdate()</code> 来处理“副作用（Side Effect，简称 Effect）”。</p>
<p>Effect 会在每次 render 完成之后被执行，刚好就是 <code class="gatsby-code-text">componentDidUpdate()</code> 触发的时机。可以在 callback 中通过条件判断来决定具体要执行哪些逻辑，也可以通过 <code class="gatsby-code-text">useEffect()</code> 的第二个参数，传入一个数组，数组中放入需要检查的属性，只有当数组里的属性和上一次不同时，callback 才会被执行。</p>
<p>Hooks 的设计目的之一，就是让相关的逻辑靠得更近，让不相关的逻辑独立开来，因此如果组件中包含有多种不同的副作用，最好交给不同的 <code class="gatsby-code-text">useEffect()</code> 去处理。</p>
<h4>2.2. <code class="gatsby-code-text">componentDidMount()</code></h4>
<p><code class="gatsby-code-text">componentDidMount()</code> 同样也用于处理副作用，因此也是通过 <code class="gatsby-code-text">useEffect()</code> 实现。</p>
<p><code class="gatsby-code-text">componentDidMount()</code> 和 <code class="gatsby-code-text">componentDidUpdate()</code> 都是在 render 之后被触发，最大的不同在于前者仅在第一次触发，后者从第二次开始往后都会触发。因此只要能够区分触发的时机，就能够用同样的函数来完成两个阶段的任务。</p>
<blockquote>
<p>Instead of thinking in terms of “mounting” and “updating”, you might find it easier to think that effects happen “after render”.</p>
<p>不用纠结“挂载”还是“更新”，你只需要简单认为“副作用发生在 render 之后”就好了。</p>
</blockquote>
<p>只需要在第二个参数位置传入一个空数组，告知该 Effect 不依赖任何属性的变化，即可将其和 <code class="gatsby-code-text">componentDidUpdate()</code> 区分开来。</p>
<p>同样的，不同的副作用应该交给不同的 <code class="gatsby-code-text">useEffect()</code> 去处理。</p>
<h4>2.3. <code class="gatsby-code-text">componentWillUnmount()</code></h4>
<p><code class="gatsby-code-text">useEffect()</code> 默认不需要返回任何东西，但如果你希望某个副作用在下一次执行之前先做点什么（比如清理一些旧数据），可以在 <code class="gatsby-code-text">useEffect()</code> 的 callback 中返回一个 cleanup 函数，在这个函数中定义的内容会在 Effect 下一次被调用之前执行。</p>
<p>如果此时 <code class="gatsby-code-text">useEffect()</code> 的第二个参数刚好是个空数组，那么就只会在组件销毁时被触发，起到 <code class="gatsby-code-text">componentWillUnMount()</code> 的作用，否则就相当于是 <code class="gatsby-code-text">componentDidUpdate()</code> 的一部分。</p>
<h4>2.4. <code class="gatsby-code-text">getDerivedStateFromProps()</code></h4>
<p>在 Hooks 的设计中，是没有这个环节的，相关逻辑全部通过用 <code class="gatsby-code-text">useEffect()</code> 触发 update 来实现。</p>
<h4>2.5. <code class="gatsby-code-text">shouldComponentUpdate()</code></h4>
<p>函数式组件可以使用 <code class="gatsby-code-text">React.memo(renderFn, areEqualFn)</code> 来进行性能优化。</p>
<p><code class="gatsby-code-text">React.memo()</code> 默认相当于 <code class="gatsby-code-text">React.PureComponent</code>，通过对 props 进行浅比较来决定是否要更新。但我们可以通过其中的 <code class="gatsby-code-text">areEqualFn</code> 来自定义判断的方式，起到 <code class="gatsby-code-text">shouldComponentUpdate()</code> 的作用。</p>
<p>需要注意的是， <code class="gatsby-code-text">areEqualFn</code> 如果返回 true 表示两次的 props 相同，不更新，这一点和 <code class="gatsby-code-text">shouldComponentUpdate()</code> 刚好相反。从函数命名上也能看出来。</p>
<p>另外，由于 <code class="gatsby-code-text">React.memo()</code> 仅适用于函数式组件，因此只比较 props，不比较 state。</p>
<h4>2.6. <code class="gatsby-code-text">getSnapshotBeforeUpdate()</code>、<code class="gatsby-code-text">componentDidCatch()</code></h4>
<p>目前还没有针对这两个生命周期函数的替代方案，但官方表示未来会有的。</p>
<p>前者用的比较少，影响不大；后者意味着 Error Boundary 在 Hooks 中暂时还用不了，不过如果组件设计的合理的话，不用也没问题。</p>
<h4>2.7. <code class="gatsby-code-text">forceUpdate()</code></h4>
<p>严格说来，这个函数不属于生命周期，但是因为和生命周期息息相关，所以放了进来。</p>
<p>React 保留了这个函数，用于在实在没办法的情况下强制触发一次 update。注意使用时候前面不用加 <code class="gatsby-code-text">this.</code>，直接调用即可。</p>
<h2>Thinking in Hooks</h2>
<p>除了语法上的变化，Hooks 在代码设计思想上也有不小的变化。如果你已经决定要开始使用 Hooks，那么有些观念需要转变一下：</p>
<h3>1. 用自定义 Hook 代替 Render Props 和 HOC</h3>
<p>在 Hooks 出现之前，想要在组件之间复用一段逻辑通常会使用 Render Props 和 High-Order Component 来解决。</p>
<p>在 React “一切皆组件”的思想下，我们早已习惯了这样的思维模式。与此同时，我们也习惯了另一件事：包裹器地狱（wrapper hell），组件层层嵌套，子子孙孙无穷无尽。</p>
<p>Hooks 通过自定义 Hook 把可复用的逻辑抽取出来，成为一个普通函数。组件间复用逻辑就像复用一个工具函数一样。</p>
<h3>2. 按业务逻辑拆分代码，而不是生命周期</h3>
<p>在 Class 中，我们按生命周期来拆分代码，这就导致一些紧密相关的业务被拆分到不同函数中，同一函数中可能包含了多个不相关的业务。</p>
<p>从计算机的角度，生命周期固然非常重要，必须熟练掌握；但从写代码的目的来看，业务逻辑才是我们关心的重点。</p>
<p>Hooks 把代码按照业务逻辑的相关性进行拆分，把同一业务的代码集中在一起，不同的业务的代码独立开来，维护起来就清楚很多。</p>
<h2>最后</h2>
<p>Hooks 从设计思路上讲，确实会比 Class 更符合直觉一点。具体在使用上还会不会有别的坑，等大家再使用一段时间看看吧。</p>
<p>Happy Hooking !</p></div></article></div></main></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"blog-2019-02-15-how-to-think-in-hooks-119","path":"/blog/2019/02/15/how-to-think-in-hooks"};window.dataPath="419/path---blog-2019-02-15-how-to-think-in-hooks-119-539-alF8Dm0IC4jAZFf67CKwKeDZE";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-acf18d00bfdc3f0366b6.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-0e2a8ce7819a0569857f.js"],"component---src-templates-project-detail-js":["/component---src-templates-project-detail-js.6f11faff120a46898de1.css","/component---src-templates-project-detail-js-285e0d5bcc3c67d6a273.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js.4d8ea8422d861346776c.css","/component---src-templates-blog-post-js-c41e4d2765231522f950.js"],"component---src-pages-404-js":["/component---src-pages-404-js.988ed18e8fd528a582e5.css","/component---src-pages-404-js-b7a4b0382a4966e8e320.js"],"component---src-pages-about-js":["/component---src-pages-about-js.34ca6a6cf623988ba788.css","/component---src-pages-about-js-9dfe65681c70c6a24bb1.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js.af91716e873bf492cbec.css","/component---src-pages-blog-js-2bee1471ca05a83211d9.js"],"component---src-pages-friend-js":["/component---src-pages-friend-js.9866a366d6728f3a1b62.css","/component---src-pages-friend-js-7c9a53d22a13f80b2d88.js"],"component---src-pages-index-js":["/component---src-pages-index-js.91170eb59cd3e082bf68.css","/component---src-pages-index-js-76d2bd902083428e9c33.js"],"component---src-pages-lab-js":["/component---src-pages-lab-js.6ec3cc2f77a0249ce7ee.css","/component---src-pages-lab-js-9a3ec8485a4b640f08bf.js"],"component---src-pages-lab-browser-ua-js":["/component---src-pages-lab-browser-ua-js.f7612934dbc50d56e2e1.css","/component---src-pages-lab-browser-ua-js-609ef801c20b9157908b.js"],"component---src-pages-lab-browser-viewport-js":["/component---src-pages-lab-browser-viewport-js.f7612934dbc50d56e2e1.css","/component---src-pages-lab-browser-viewport-js-40e36f49e641604d88b9.js"],"component---src-pages-lab-html-5-canvas-js":["/component---src-pages-lab-html-5-canvas-js.f7612934dbc50d56e2e1.css","/component---src-pages-lab-html-5-canvas-js-54cb54ec6d8aac0e9ba5.js"],"component---src-pages-lab-html-5-connection-js":["/component---src-pages-lab-html-5-connection-js.f7612934dbc50d56e2e1.css","/component---src-pages-lab-html-5-connection-js-9ec9b636315310030204.js"],"component---src-pages-lab-html-5-geolocation-js":["/component---src-pages-lab-html-5-geolocation-js.f7612934dbc50d56e2e1.css","/component---src-pages-lab-html-5-geolocation-js-2c58637b1f994f19d833.js"],"component---src-pages-lab-html-5-input-js":["/component---src-pages-lab-html-5-input-js.69d8404bc9e4fefafd9c.css","/component---src-pages-lab-html-5-input-js-35c7857ecfa137aec0e2.js"],"component---src-pages-lab-html-5-online-js":["/component---src-pages-lab-html-5-online-js.58e723170222edde88db.css","/component---src-pages-lab-html-5-online-js-37e9c29445f2cdc16534.js"],"component---src-pages-project-js":["/component---src-pages-project-js.d675800aea4d3b2096c4.css","/component---src-pages-project-js-a708e4ec53f54f1a1841.js"],"pages-manifest":["/pages-manifest-622ad73d678fcc485a4e.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-c41e4d2765231522f950.js" async=""></script><script src="/0-03dbf3f5683c24ff3c45.js" async=""></script><script src="/app-acf18d00bfdc3f0366b6.js" async=""></script><script src="/webpack-runtime-f2e44dcec149a4927514.js" async=""></script></body></html>